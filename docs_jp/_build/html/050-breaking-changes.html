

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Solidity v0.5.0 Breaking Changes &mdash; Solidity 0.5.4 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Security Considerations" href="security-considerations.html" />
    <link rel="prev" title="Miscellaneous" href="miscellaneous.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Solidity
          

          
          </a>

          
            
            
              <div class="version">
                0.5.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction-to-smart-contracts.html">Introduction to Smart Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing-solidity.html">Installing the Solidity Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="solidity-by-example.html">Solidity by Example</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="solidity-in-depth.html">Solidity in Depth</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="layout-of-source-files.html">Layout of a Solidity Source File</a></li>
<li class="toctree-l2"><a class="reference internal" href="structure-of-a-contract.html">Structure of a Contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="units-and-global-variables.html">Units and Globally Available Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="control-structures.html">Expressions and Control Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="contracts.html">Contracts</a></li>
<li class="toctree-l2"><a class="reference internal" href="assembly.html">Solidity Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="miscellaneous.html">Miscellaneous</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Solidity v0.5.0 Breaking Changes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#semantic-only-changes">Semantic Only Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#semantic-and-syntactic-changes">Semantic and Syntactic Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#explicitness-requirements">Explicitness Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deprecated-elements">Deprecated Elements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#command-line-and-json-interfaces">Command Line and JSON Interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#constructors">Constructors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conversions">Conversions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#literals-and-suffixes">Literals and Suffixes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#variables">Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#syntax">Syntax</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#interoperability-with-older-contracts">Interoperability With Older Contracts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="security-considerations.html">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-the-compiler.html">Using the compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Contract Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html">Contract ABI Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="yul.html">Yul</a></li>
<li class="toctree-l1"><a class="reference internal" href="style-guide.html">Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-patterns.html">Common Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="bugs.html">List of Known Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="frequently-asked-questions.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="lll.html">LLL</a></li>
</ul>

            
          
    <a href="genindex.html">Keyword Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Solidity</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="solidity-in-depth.html">Solidity in Depth</a> &raquo;</li>
        
      <li>Solidity v0.5.0 Breaking Changes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/050-breaking-changes.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="solidity-v0-5-0-breaking-changes">
<h1>Solidity v0.5.0 Breaking Changes<a class="headerlink" href="#solidity-v0-5-0-breaking-changes" title="Permalink to this headline">¶</a></h1>
<p>このセクションではSolidityバージョン0.5.0で導入された主要な変更を、変更の理由と影響あるコードをアップデートする方法と共に紹介します。
フルリストは、<a class="reference external" href="https://github.com/ethereum/solidity/releases/tag/v0.5.0">the release changelog</a> を参照ください。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Solidityのバージョン0.5.0でコンパイルされたコントラクトは古いバージョンでコンパイルされたコントラクトやライブラリを再コンパイルもしくは再デプロイなしに使えます。
データロケーション、可視性、ミュータビリティを含めるようにインターフェースを変えれば十分です。下記の <a class="reference internal" href="#interoperability"><span class="std std-ref">Interoperability With Older Contracts</span></a> を参照ください。</p>
</div>
<div class="section" id="semantic-only-changes">
<h2>Semantic Only Changes<a class="headerlink" href="#semantic-only-changes" title="Permalink to this headline">¶</a></h2>
<p>このセクションはセマンティクス上の変更だけのリストです。そのため、潜在的には現状のコードで、新しいもしくは異なる動作をしてしまうかもしれません。</p>
<ul class="simple">
<li>符号付右シフトは現在適切な算術シフトを使っています。つまり、0への丸めの代わりに負の無限大への丸めとなります。符号付、符号なしのシフトはConstantinopleで専用のopcodeになり、その間Solidityによってエミュレートされます。</li>
<li><code class="docutils literal notranslate"><span class="pre">do...while</span></code> ループの中の <code class="docutils literal notranslate"><span class="pre">continue</span></code> は現在条件文にjumpします。そのような場合になる一般的な挙動です。以前はループの本体にjumpしていました。もし条件文がfalseだった場合、ループは終了します。</li>
<li><code class="docutils literal notranslate"><span class="pre">bytes</span></code> が1つ与えられた時に、ファンクションの <code class="docutils literal notranslate"><span class="pre">.call()</span></code>、<code class="docutils literal notranslate"><span class="pre">.delegatecall()</span></code>、<code class="docutils literal notranslate"><span class="pre">.staticcall()</span></code> はもうパディングしません。</li>
<li>pureとviewファンクションはEVMバージョンがByzantium以降であれば、<code class="docutils literal notranslate"><span class="pre">CALL</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> を使って呼ばれます。このopcodeではEVMレベルで、状態変更ができません。</li>
<li>外部のファンクションコールと <code class="docutils literal notranslate"><span class="pre">abi.encode</span></code> で使われた時、ABIエンコーダは現在calldata（ <code class="docutils literal notranslate"><span class="pre">msg.data</span></code> と外部のファンクションパラメータ）のバイト配列と文字列を適切にパディングします。パディングされないエンコードしたい時は、<code class="docutils literal notranslate"><span class="pre">abi.encodePacked</span></code> を使用してください。</li>
<li>ABIデコーダは渡されたcalldataが短すぎるもしくは範囲外を指し示していたら、ファンクションの始めと <code class="docutils literal notranslate"><span class="pre">abi.decode()</span></code> で状態を全て元に戻します。</li>
</ul>
<p>汚れた高次ビットは単純に無視されるということを覚えておいてください。</p>
<ul class="simple">
<li>Tangerine Whistleからは外部のファンクションコールで使用可能な全てのガスを転送します。</li>
</ul>
</div>
<div class="section" id="semantic-and-syntactic-changes">
<h2>Semantic and Syntactic Changes<a class="headerlink" href="#semantic-and-syntactic-changes" title="Permalink to this headline">¶</a></h2>
<p>このセクションではシンタックスとセマンティクスに関連する変更を紹介します。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">.call()</span></code>、<code class="docutils literal notranslate"><span class="pre">.delegatecall()</span></code>、<code class="docutils literal notranslate"><span class="pre">staticcall()</span></code>、<code class="docutils literal notranslate"><span class="pre">keccak256()</span></code>、<code class="docutils literal notranslate"><span class="pre">sha256()</span></code>、<code class="docutils literal notranslate"><span class="pre">ripemd160()</span></code> は1つの <code class="docutils literal notranslate"><span class="pre">bytes</span></code> 引数だけを受け入れます。さらに引数はパディングされません。これは引数がどのように連結させるかをわかりやすくするためです。</li>
</ul>
<p>全ての <code class="docutils literal notranslate"><span class="pre">.call()</span></code> (and family) を <code class="docutils literal notranslate"><span class="pre">.call(&quot;&quot;)</span></code> に代えてください。<code class="docutils literal notranslate"><span class="pre">.call(signature,</span> <span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">c)</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">.call(abi.encodeWithSignature(signature,</span> <span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">c))</span></code> (最後のものは値型にしか使えません)を使ってください。また、<code class="docutils literal notranslate"><span class="pre">keccak256(a,</span> <span class="pre">b,</span> <span class="pre">c)</span></code> を <code class="docutils literal notranslate"><span class="pre">keccak256(abi.encodePacked(a,</span> <span class="pre">b,</span> <span class="pre">c))</span></code> に代えてください。ブレーキングチェンジではありませんが、<code class="docutils literal notranslate"><span class="pre">x.call(bytes4(keccak256(&quot;f(uint256)&quot;),</span> <span class="pre">a,</span> <span class="pre">b)</span></code> から <code class="docutils literal notranslate"><span class="pre">x.call(abi.encodeWithSignature(&quot;f(uint256)&quot;,</span> <span class="pre">a,</span> <span class="pre">b))</span></code> に代えることをお勧めします。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">.call()</span></code>、<code class="docutils literal notranslate"><span class="pre">.delegatecall()</span></code>、<code class="docutils literal notranslate"><span class="pre">.staticcall()</span></code> は返ってきたデータにアクセスできるように現在 <code class="docutils literal notranslate"><span class="pre">(bool,</span> <span class="pre">bytes</span> <span class="pre">memory)</span></code> を返します。<code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">success</span> <span class="pre">=</span> <span class="pre">otherContract.call(&quot;f&quot;)</span></code> を <code class="docutils literal notranslate"><span class="pre">(bool</span> <span class="pre">success,</span> <span class="pre">bytes</span> <span class="pre">memory</span> <span class="pre">data)</span> <span class="pre">=</span> <span class="pre">otherContract.call(&quot;f&quot;)</span></code> に変更して下さい。</li>
<li>Solidityは現在ファンクションのローカル変数に対してC99-styleのスコーピングのルールを使っています。その中で、変数は宣言された後でのみ有効で、同じもしくはネストされたスコープでのみ使えます。<code class="docutils literal notranslate"><span class="pre">for</span></code> ループの初期化ブロックの中で宣言された変数はループ内のどこでも有効です。</li>
</ul>
</div>
<div class="section" id="explicitness-requirements">
<h2>Explicitness Requirements<a class="headerlink" href="#explicitness-requirements" title="Permalink to this headline">¶</a></h2>
<p>このセクションはコードをもっと明示的にする様な変更のリストです。
ほとんどの場合、コンパイラが忠告を出してくれます。</p>
<ul class="simple">
<li>明示的なファンクションの可視性は現在必須です。可視性を特に指示していないものに関して、ファンクションとコンストラクタには <code class="docutils literal notranslate"><span class="pre">public</span></code> を追加し、fallbackとインターフェースには <code class="docutils literal notranslate"><span class="pre">external</span></code> を追加して下さい。</li>
<li>構造体、配列、マッピングに関して明示的なデータロケーションは現在必須です。これはファンクションのパラメータや返り値にも適用されます。例えば、<code class="docutils literal notranslate"><span class="pre">uint[]</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">m_x</span></code> は <code class="docutils literal notranslate"><span class="pre">uint[]</span> <span class="pre">storage</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">m_x</span></code> に、<code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">f(uint[][]</span> <span class="pre">x)</span></code> は <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">f(uint[][]</span> <span class="pre">memory</span> <span class="pre">x)</span></code> に代えてください。</li>
</ul>
<p>ここで、<code class="docutils literal notranslate"><span class="pre">memory</span></code> はデータロケーションで、場合によって <code class="docutils literal notranslate"><span class="pre">storage</span></code> や <code class="docutils literal notranslate"><span class="pre">calldata</span></code> に置き換えられます。<code class="docutils literal notranslate"><span class="pre">external</span></code> のファンクションはデータロケーションとして　<code class="docutils literal notranslate"><span class="pre">calldata</span></code> が必要なことを覚えておいてください。</p>
<ul class="simple">
<li>名前空間を分けるために、コントラクト型は <code class="docutils literal notranslate"><span class="pre">address</span></code> メンバをもう持っていません。そのため、<code class="docutils literal notranslate"><span class="pre">address</span></code> メンバを使う前に明示的にコントラクト型の値をアドレスに変換する必要があります。例： <code class="docutils literal notranslate"><span class="pre">c</span></code> がコントラクトの場合、<code class="docutils literal notranslate"><span class="pre">c.transfer(...)</span></code> から <code class="docutils literal notranslate"><span class="pre">address(c).transfer(...)</span></code> に、<code class="docutils literal notranslate"><span class="pre">c.balance</span></code> は <code class="docutils literal notranslate"><span class="pre">address(c).balance</span></code> に代えてください。</li>
<li>関係ないコントラクト型同士の明示的な変換は現在できません。あるコントラクト型から、そのベースもしくは親（祖先）のコントラクト型への変換のみ可能です。もし継承していないのにも関わらず、あるコントラクトから別のコントラクトへの変換ができると考えているのであれば、まず <code class="docutils literal notranslate"><span class="pre">address</span></code> へ変換することで対処できます。例: <code class="docutils literal notranslate"><span class="pre">A</span></code> と <code class="docutils literal notranslate"><span class="pre">B</span></code> がコントラクト型で <code class="docutils literal notranslate"><span class="pre">B</span></code> が <code class="docutils literal notranslate"><span class="pre">A</span></code> を継承しておらず、<code class="docutils literal notranslate"><span class="pre">b</span></code> が <code class="docutils literal notranslate"><span class="pre">B</span></code> 型のコントラクトである場合、<code class="docutils literal notranslate"><span class="pre">A(address(b))</span></code> を使うことで <code class="docutils literal notranslate"><span class="pre">b</span></code> を <code class="docutils literal notranslate"><span class="pre">A</span></code> 型に変換できます。</li>
</ul>
<p>下記で説明されている通り、payable fallbackファンクションのマッチングに気をつける必要があります。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">address</span></code> 型は <code class="docutils literal notranslate"><span class="pre">address</span></code> と <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> に分けられ、<code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> だけが <code class="docutils literal notranslate"><span class="pre">transfer</span></code> ファンクションを使えます。<code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> は直接 <code class="docutils literal notranslate"><span class="pre">address</span></code> に変換可能ですが、逆はできません。<code class="docutils literal notranslate"><span class="pre">address</span></code> から <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> への変換は <code class="docutils literal notranslate"><span class="pre">uint160</span></code> を通じて行うことで可能です。<code class="docutils literal notranslate"><span class="pre">c</span></code> がコントラクトで、payable fallbackファンクションを持っていた場合、<code class="docutils literal notranslate"><span class="pre">address(c)</span></code> は <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> になります。もし <a class="reference internal" href="common-patterns.html#withdrawal-pattern"><span class="std std-ref">withdraw pattern</span></a> を使っているのであれば、コードを変える必要はきっとないでしょう。なぜなら、<code class="docutils literal notranslate"><span class="pre">transfer</span></code> は 保存されているアドレスの代わりに <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> にのみ使われ、<code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> は <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> だからです。</li>
<li>異なるサイズの <code class="docutils literal notranslate"><span class="pre">bytesX</span></code> と <code class="docutils literal notranslate"><span class="pre">uintY</span></code> 間の変換は現在できません。なぜなら、<code class="docutils literal notranslate"><span class="pre">bytesX</span></code> は右パディングで <code class="docutils literal notranslate"><span class="pre">uintY</span></code> は左パディングのため、予期しない変換結果を生じる可能性があるためです。変換前に型内でサイズは調整される必要があります。例えば、始めに <code class="docutils literal notranslate"><span class="pre">bytes4</span></code> を <code class="docutils literal notranslate"><span class="pre">bytes8</span></code> に変換してから <code class="docutils literal notranslate"><span class="pre">uint64</span></code> に変換することで <code class="docutils literal notranslate"><span class="pre">bytes4</span></code> (4 bytes) を <code class="docutils literal notranslate"><span class="pre">uint64</span></code> (8 bytes) に変換することができます。<code class="docutils literal notranslate"><span class="pre">uint32</span></code> を通じて変換すると逆側のパディングをすることになります。</li>
<li>payableではないファンクションで <code class="docutils literal notranslate"><span class="pre">msg.value</span></code> を使うこと（もしくはmodifierを使って実行する）はセキュリティの機能によりできません。</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">payable</span></code> のファンクションに変換するか、<code class="docutils literal notranslate"><span class="pre">msg.value</span></code> を使う新しいinternalのファンクションを作ってください。</p>
<ul class="simple">
<li>分かりやすくするため、標準入力がソースとして使用される場合、コマンドラインインターフェースに <code class="docutils literal notranslate"><span class="pre">-</span></code> が必要です。</li>
</ul>
</div>
<div class="section" id="deprecated-elements">
<h2>Deprecated Elements<a class="headerlink" href="#deprecated-elements" title="Permalink to this headline">¶</a></h2>
<p>このセクションでは以前の機能やシンタックスで非推奨に変更になったリストを紹介します。これらの多くは既に <code class="docutils literal notranslate"><span class="pre">v0.5.0</span></code> のexperimental modeでは使用できません。</p>
<div class="section" id="command-line-and-json-interfaces">
<h3>Command Line and JSON Interfaces<a class="headerlink" href="#command-line-and-json-interfaces" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>コマンドラインオプションの <code class="docutils literal notranslate"><span class="pre">--formal</span></code> （形式的検証のため以前はWhy3のアウトプットを生成していた）は非推奨隣、現在は削除されました。新しい形式的検証のモジュールのSMTCheckerは <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">experimental</span> <span class="pre">SMTChecker;</span></code> で使うことができます。</li>
<li>中間言語の名前が <code class="docutils literal notranslate"><span class="pre">Julia</span></code> から <code class="docutils literal notranslate"><span class="pre">Yul</span></code> へ変更になったためコマンドラインオプションの <code class="docutils literal notranslate"><span class="pre">--julia</span></code> は <code class="docutils literal notranslate"><span class="pre">--yul</span></code> へ名前が変更されました。</li>
<li>コマンドラインオプションの <code class="docutils literal notranslate"><span class="pre">--clone-bin</span></code> と <code class="docutils literal notranslate"><span class="pre">--combined-json</span> <span class="pre">clone-bin</span></code> は削除されました。</li>
<li>空の接頭辞での理マッピングはできません。</li>
<li>JSON ASTフィールドの <code class="docutils literal notranslate"><span class="pre">constant</span></code> と <code class="docutils literal notranslate"><span class="pre">payable</span></code> は削除されました。その情報は現在 <code class="docutils literal notranslate"><span class="pre">stateMutability</span></code> フィールドにあります。</li>
<li>JSON ASTフィールドの <code class="docutils literal notranslate"><span class="pre">FunctionDefinition</span></code> ノード</li>
</ul>
<p>の <code class="docutils literal notranslate"><span class="pre">isConstructor</span></code> は <code class="docutils literal notranslate"><span class="pre">kind</span></code> というフィールドに置き換えられ、<code class="docutils literal notranslate"><span class="pre">&quot;constructor&quot;</span></code>、<code class="docutils literal notranslate"><span class="pre">&quot;fallback&quot;</span></code>、<a href="#id1"><span class="problematic" id="id2">``</span></a>”function”` という値を持つことができます。</p>
<ul class="simple">
<li>リンクしてないbinary hexファイルでは、ライブラリアドレスのプレースホルダは正規のライブラリの名前全体のkeccak256ハッシュの最初の16進数の36文字で、<code class="docutils literal notranslate"><span class="pre">$...$</span></code> に囲われています。</li>
</ul>
<p>以前は正規のライブラリの名前だけ使われていました。これにより、特にパスが長い時は名前が衝突する可能性が減ります。バイナリファイルは現在、このプレースホルダから正規の名前全体のマッピングのリストを含んでいます。</p>
</div>
<div class="section" id="constructors">
<h3>Constructors<a class="headerlink" href="#constructors" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>コンストラクトは現在、<code class="docutils literal notranslate"><span class="pre">constructor</span></code> を使って定義しなければいけません。</li>
<li>括弧なしのベースのコンストラクトを呼び出すことは現在できません。</li>
<li>同じ継承の階層でベースのコンストラクトの引数をな何度も決めることは現在できません。</li>
<li>間違った数の引数でコンストラクタを呼ぶことはできません。もし引数を渡さないで継承の関係を指定したい場合は、括弧をつけないで下さい。</li>
</ul>
</div>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">callcode</span></code> ファンクションは現在使えません（）。</li>
</ul>
<p>Function <code class="docutils literal notranslate"><span class="pre">callcode</span></code> is now disallowed ( <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> が使われます)。インラインアセンブリを使えば使うことができます。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">suicide</span></code> は現在使えません( <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code> が使われます).</li>
<li><code class="docutils literal notranslate"><span class="pre">sha3</span></code> は現在使えません( <code class="docutils literal notranslate"><span class="pre">keccak256</span></code> が使われます).</li>
<li><code class="docutils literal notranslate"><span class="pre">throw</span></code> は現在使えません( <code class="docutils literal notranslate"><span class="pre">revert</span></code>、<code class="docutils literal notranslate"><span class="pre">require</span></code>、<code class="docutils literal notranslate"><span class="pre">assert</span></code> が使われます)。</li>
</ul>
</div>
<div class="section" id="conversions">
<h3>Conversions<a class="headerlink" href="#conversions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>明示的にも暗示的にも10進数リテラルの <code class="docutils literal notranslate"><span class="pre">bytesXX</span></code> 型への変換は現在使えません。</li>
<li>明示的にも暗示的にも16進数リテラルの異なるサイズの <code class="docutils literal notranslate"><span class="pre">bytesXX</span></code> 型への変換は現在使えません。</li>
</ul>
</div>
<div class="section" id="literals-and-suffixes">
<h3>Literals and Suffixes<a class="headerlink" href="#literals-and-suffixes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>閏年で混乱してしまうため <code class="docutils literal notranslate"><span class="pre">years</span></code> という単位名は現在使えません。数字の後に</li>
<li>数字の続かない末尾のドットは使えません。</li>
<li>16進数の数字とuintの単位名(例: <code class="docutils literal notranslate"><span class="pre">0x1e</span> <span class="pre">wei</span></code>) は一緒に使えません。</li>
<li>16進数に接頭辞 <code class="docutils literal notranslate"><span class="pre">0X</span></code> は使えません。<code class="docutils literal notranslate"><span class="pre">0x</span></code> だけ使えます。</li>
</ul>
</div>
<div class="section" id="variables">
<h3>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>分かりやすさのため、空の構造体の宣言は現在できません。</li>
<li>分かりやすさのため、現在 <code class="docutils literal notranslate"><span class="pre">var</span></code> キーワードは使えません。</li>
<li>タプルへの異なった要素数の割り当ては現在できません。</li>
<li>コンパイル時に定数でない定数値は使えません。</li>
<li>値の数と変数の数が合わない複数変数の宣言は現在使えません。</li>
<li>初期化されていないストレージ変数は現在使えません。</li>
<li>空のタプル要素は現在使えません。</li>
<li>変数と構造体の循環参照の検知の繰り返しは256回までと制限されています。</li>
<li>長さが0の固定長さ配列は現在使えません。</li>
</ul>
</div>
<div class="section" id="syntax">
<h3>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>ファンクションのstate mutability modifierとしての <code class="docutils literal notranslate"><span class="pre">constant</span></code> は現在使えません。</li>
<li>真偽式は算術演算を行えません。</li>
<li>単項の <code class="docutils literal notranslate"><span class="pre">+</span></code> 演算子は使えません。</li>
<li>リテラルは以前の明示的な型への変換なしでは <code class="docutils literal notranslate"><span class="pre">abi.encodePacked</span></code> を使えません。</li>
<li>返り値があるファンクションでの空のリターンは現在使えません。</li>
<li>“loose assembly”シンタックスは現在完全に使えません。つまりjump label、jump、非ファンクショナルな指示はもう使えません。新しい <code class="docutils literal notranslate"><span class="pre">while</span></code>、<code class="docutils literal notranslate"><span class="pre">switch</span></code>、<code class="docutils literal notranslate"><span class="pre">if</span></code> を代わりに使ってください。</li>
<li>実行されないファンクションではmodifierは使えません。</li>
<li>名前のついた返り値のファンクション型は使えません。</li>
<li>if/while/forのブロックでないボディ内での単文での変数の宣言はできません。</li>
<li>New keywords: <code class="docutils literal notranslate"><span class="pre">calldata</span></code> and <code class="docutils literal notranslate"><span class="pre">constructor</span></code>.</li>
<li>New reserved keywords: <code class="docutils literal notranslate"><span class="pre">alias</span></code>, <code class="docutils literal notranslate"><span class="pre">apply</span></code>, <code class="docutils literal notranslate"><span class="pre">auto</span></code>, <code class="docutils literal notranslate"><span class="pre">copyof</span></code>,
<code class="docutils literal notranslate"><span class="pre">define</span></code>, <code class="docutils literal notranslate"><span class="pre">immutable</span></code>, <code class="docutils literal notranslate"><span class="pre">implements</span></code>, <code class="docutils literal notranslate"><span class="pre">macro</span></code>, <code class="docutils literal notranslate"><span class="pre">mutable</span></code>,
<code class="docutils literal notranslate"><span class="pre">override</span></code>, <code class="docutils literal notranslate"><span class="pre">partial</span></code>, <code class="docutils literal notranslate"><span class="pre">promise</span></code>, <code class="docutils literal notranslate"><span class="pre">reference</span></code>, <code class="docutils literal notranslate"><span class="pre">sealed</span></code>,
<code class="docutils literal notranslate"><span class="pre">sizeof</span></code>, <code class="docutils literal notranslate"><span class="pre">supports</span></code>, <code class="docutils literal notranslate"><span class="pre">typedef</span></code> and <code class="docutils literal notranslate"><span class="pre">unchecked</span></code>.</li>
</ul>
</div>
</div>
<div class="section" id="interoperability-with-older-contracts">
<span id="interoperability"></span><h2>Interoperability With Older Contracts<a class="headerlink" href="#interoperability-with-older-contracts" title="Permalink to this headline">¶</a></h2>
<p>インターフェースを定義すれば、Solidityバージョン0.5.0以前（もしくは以降）で書かれたコントラクトで使うことができます。
0.5.0以前のバージョンで作った以下のコントラクトを見てください。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// This will not compile with the current version of the compiler</span>
<span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">25</span><span class="p">;</span>
<span class="kd">contract</span> <span class="n">OldContract</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="n">someOldFunction</span><span class="p">(</span><span class="kt">uint8</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//...</span>
   <span class="p">}</span>
   <span class="kd">function</span> <span class="n">anotherOldFunction</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//...</span>
   <span class="p">}</span>
   <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>これは0.5.0ではコンパイルできませんが、互換性のあるインターフェースは定義できます。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="kd">interface</span> <span class="n">OldContract</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="n">someOldFunction</span><span class="p">(</span><span class="kt">uint8</span> <span class="n">a</span><span class="p">)</span> <span class="kr">external</span><span class="p">;</span>
   <span class="kd">function</span> <span class="n">anotherOldFunction</span><span class="p">()</span> <span class="kr">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>オリジナルのコントラクトでは <code class="docutils literal notranslate"><span class="pre">constant</span></code> と宣言されているのにも関わらず、<code class="docutils literal notranslate"><span class="pre">anotherOldFunction</span></code> を <code class="docutils literal notranslate"><span class="pre">view</span></code> で宣言していないことに注目して下さい。これはSolidity v0.5.0から <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> が <code class="docutils literal notranslate"><span class="pre">view</span></code> ファンクションを呼ぶのに使われ始めたからです。
v0.5.0以前では <code class="docutils literal notranslate"><span class="pre">constant</span></code> キーワードは強制ではありませんでしたので、<code class="docutils literal notranslate"><span class="pre">constant</span></code> と宣言されたファンクションを <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> で呼び出してもrevertする可能性がありました。なぜなら、<code class="docutils literal notranslate"><span class="pre">constant</span></code> ファンクションはストレージを修正しようとする可能性があったためです。
結論としては、古いコントラクト用のインターフェースを定義するときには、<code class="docutils literal notranslate"><span class="pre">staticcall</span></code> で確実にファンクションが動作する様に、<code class="docutils literal notranslate"><span class="pre">constant</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">view</span></code> を使った方が良いでしょう。</p>
<p>上記で定義されたインターフェースがあれば、もう簡単に0.5.0以前のコントラクトをデプロイできます。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">interface</span> <span class="n">OldContract</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="n">someOldFunction</span><span class="p">(</span><span class="kt">uint8</span> <span class="n">a</span><span class="p">)</span> <span class="kr">external</span><span class="p">;</span>
   <span class="kd">function</span> <span class="n">anotherOldFunction</span><span class="p">()</span> <span class="kr">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">NewContract</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="n">doSomething</span><span class="p">(</span><span class="n">OldContract</span> <span class="n">a</span><span class="p">)</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">a</span><span class="p">.</span><span class="n">someOldFunction</span><span class="p">(</span><span class="mh">0x42</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">anotherOldFunction</span><span class="p">();</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>同様に、0.5.0以前のライブラリは実行せず、リンク中にそのライブラリのアドレスを渡さなくても、そのライブラリのファンクションを定義することで、使用することができます（リンキングにどうやってコマンドラインコンパイラを使うかは <a class="reference internal" href="using-the-compiler.html#commandline-compiler"><span class="std std-ref">Using the Commandline Compiler</span></a> を参照ください）。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">library</span> <span class="n">OldLibrary</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="n">someFunction</span><span class="p">(</span><span class="kt">uint8</span> <span class="n">a</span><span class="p">)</span> <span class="kr">public</span> <span class="k">returns</span><span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">NewContract</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint8</span> <span class="n">a</span><span class="p">)</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">OldLibrary</span><span class="p">.</span><span class="n">someFunction</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>下記の例ではあるコントラクトとこのセクションで紹介したいくつかの変更を加えたSolidityバージョン0.5.0のコントラクトを紹介します。</p>
<p>Old version:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// This will not compile</span>
<span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">25</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">OtherContract</span> <span class="p">{</span>
   <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>
   <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">y</span><span class="p">)</span> <span class="kr">external</span> <span class="p">{</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="kd">function</span><span class="p">()</span> <span class="kr">payable</span> <span class="kr">external</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Old</span> <span class="p">{</span>
   <span class="n">OtherContract</span> <span class="n">other</span><span class="p">;</span>
   <span class="kt">uint</span> <span class="n">myNumber</span><span class="p">;</span>

   <span class="c1">// Function mutability not provided, not an error.</span>
   <span class="kd">function</span> <span class="n">someInteger</span><span class="p">()</span> <span class="kr">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>

   <span class="c1">// Function visibility not provided, not an error.</span>
   <span class="c1">// Function mutability not provided, not an error.</span>
   <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Var is fine in this version.</span>
      <span class="kd">var</span> <span class="n">z</span> <span class="o">=</span> <span class="n">someInteger</span><span class="p">();</span>
      <span class="n">x</span> <span class="o">+=</span> <span class="n">z</span><span class="p">;</span>
      <span class="c1">// Throw is fine in this version.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span>
         <span class="k">throw</span><span class="p">;</span>
      <span class="kt">bytes</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
      <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
      <span class="c1">// y == -1 (wrong, should be -2)</span>
      <span class="k">do</span> <span class="p">{</span>
         <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
         <span class="c1">// &#39;Continue&#39; causes an infinite loop.</span>
      <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">);</span>
      <span class="c1">// Call returns only a Bool.</span>
      <span class="kt">bool</span> <span class="n">success</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">other</span><span class="p">).</span><span class="nf">call</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span>
         <span class="nf">revert</span><span class="p">();</span>
      <span class="k">else</span> <span class="p">{</span>
         <span class="c1">// Local variables could be declared after their use.</span>
         <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">// No need for an explicit data location for &#39;arr&#39;</span>
   <span class="kd">function</span> <span class="n">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="n">arr</span><span class="p">,</span> <span class="kt">bytes8</span> <span class="n">x</span><span class="p">,</span> <span class="n">OtherContract</span> <span class="n">otherContract</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
      <span class="n">otherContract</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="mi">1</span> <span class="kc">ether</span><span class="p">);</span>

      <span class="c1">// Since uint32 (4 bytes) is smaller than bytes8 (8 bytes),</span>
      <span class="c1">// the first 4 bytes of x will be lost. This might lead to</span>
      <span class="c1">// unexpected behavior since bytesX are right padded.</span>
      <span class="kt">uint32</span> <span class="n">y</span> <span class="o">=</span> <span class="kt">uint32</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
      <span class="n">myNumber</span> <span class="o">+=</span> <span class="n">y</span> <span class="o">+</span> <span class="nb">msg.value</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>New version:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">OtherContract</span> <span class="p">{</span>
   <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>
   <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">y</span><span class="p">)</span> <span class="kr">external</span> <span class="p">{</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="kd">function</span><span class="p">()</span> <span class="kr">payable</span> <span class="kr">external</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">New</span> <span class="p">{</span>
   <span class="n">OtherContract</span> <span class="n">other</span><span class="p">;</span>
   <span class="kt">uint</span> <span class="n">myNumber</span><span class="p">;</span>

   <span class="c1">// Function mutability must be specified.</span>
   <span class="kd">function</span> <span class="n">someInteger</span><span class="p">()</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>

   <span class="c1">// Function visibility must be specified.</span>
   <span class="c1">// Function mutability must be specified.</span>
   <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes</span> <span class="kr">memory</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// The type must now be explicitly given.</span>
      <span class="kt">uint</span> <span class="n">z</span> <span class="o">=</span> <span class="n">someInteger</span><span class="p">();</span>
      <span class="n">x</span> <span class="o">+=</span> <span class="n">z</span><span class="p">;</span>
      <span class="c1">// Throw is now disallowed.</span>
      <span class="nf">require</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">);</span>
      <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
      <span class="c1">// y == -2 (correct)</span>
      <span class="k">do</span> <span class="p">{</span>
         <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
         <span class="c1">// &#39;Continue&#39; jumps to the condition below.</span>
      <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">);</span>

      <span class="c1">// Call returns (bool, bytes).</span>
      <span class="c1">// Data location must be specified.</span>
      <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">data</span><span class="p">)</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">other</span><span class="p">).</span><span class="nf">call</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span>
         <span class="nf">revert</span><span class="p">();</span>
      <span class="k">return</span> <span class="n">data</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kn">using</span> <span class="n">address_make_payable</span> <span class="k">for</span> <span class="kt">address</span><span class="p">;</span>
   <span class="c1">// Data location for &#39;arr&#39; must be specified</span>
   <span class="kd">function</span> <span class="n">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">arr</span><span class="p">,</span> <span class="kt">bytes8</span> <span class="n">x</span><span class="p">,</span> <span class="n">OtherContract</span> <span class="n">otherContract</span><span class="p">,</span> <span class="kt">address</span> <span class="n">unknownContract</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
      <span class="c1">// &#39;otherContract.transfer&#39; is not provided.</span>
      <span class="c1">// Since the code of &#39;OtherContract&#39; is known and has the fallback</span>
      <span class="c1">// function, address(otherContract) has type &#39;address payable&#39;.</span>
      <span class="kt">address</span><span class="p">(</span><span class="n">otherContract</span><span class="p">).</span><span class="nf">transfer</span><span class="p">(</span><span class="mi">1</span> <span class="kc">ether</span><span class="p">);</span>

      <span class="c1">// &#39;unknownContract.transfer&#39; is not provided.</span>
      <span class="c1">// &#39;address(unknownContract).transfer&#39; is not provided</span>
      <span class="c1">// since &#39;address(unknownContract)&#39; is not &#39;address payable&#39;.</span>
      <span class="c1">// If the function takes an &#39;address&#39; which you want to send</span>
      <span class="c1">// funds to, you can convert it to &#39;address payable&#39; via &#39;uint160&#39;.</span>
      <span class="c1">// Note: This is not recommended and the explicit type</span>
      <span class="c1">// &#39;address payable&#39; should be used whenever possible.</span>
      <span class="c1">// To increase clarity, we suggest the use of a library for</span>
      <span class="c1">// the conversion (provided after the contract in this example).</span>
      <span class="kt">address</span> <span class="kr">payable</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">unknownContract</span><span class="p">.</span><span class="n">make_payable</span><span class="p">();</span>
      <span class="nf">require</span><span class="p">(</span><span class="n">addr</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="mi">1</span> <span class="kc">ether</span><span class="p">));</span>

      <span class="c1">// Since uint32 (4 bytes) is smaller than bytes8 (8 bytes),</span>
      <span class="c1">// the conversion is not allowed.</span>
      <span class="c1">// We need to convert to a common size first:</span>
      <span class="kt">bytes4</span> <span class="n">x4</span> <span class="o">=</span> <span class="kt">bytes4</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="c1">// Padding happens on the right</span>
      <span class="kt">uint32</span> <span class="n">y</span> <span class="o">=</span> <span class="kt">uint32</span><span class="p">(</span><span class="n">x4</span><span class="p">);</span> <span class="c1">// Conversion is consistent</span>
      <span class="c1">// &#39;msg.value&#39; cannot be used in a &#39;non-payable&#39; function.</span>
      <span class="c1">// We need to make the function payable</span>
      <span class="n">myNumber</span> <span class="o">+=</span> <span class="n">y</span> <span class="o">+</span> <span class="nb">msg.value</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// We can define a library for explicitly converting ``address``</span>
<span class="c1">// to ``address payable`` as a workaround.</span>
<span class="kd">library</span> <span class="n">address_make_payable</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="n">make_payable</span><span class="p">(</span><span class="kt">address</span> <span class="n">x</span><span class="p">)</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="kr">payable</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kt">address</span><span class="p">(</span><span class="kt">uint160</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="security-considerations.html" class="btn btn-neutral float-right" title="Security Considerations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="miscellaneous.html" class="btn btn-neutral float-left" title="Miscellaneous" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2019, Ethereum

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>