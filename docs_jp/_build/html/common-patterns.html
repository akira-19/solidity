

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Common Patterns &mdash; Solidity 0.5.4 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="List of Known Bugs" href="bugs.html" />
    <link rel="prev" title="Style Guide" href="style-guide.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Solidity
          

          
          </a>

          
            
            
              <div class="version">
                0.5.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction-to-smart-contracts.html">Introduction to Smart Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing-solidity.html">Installing the Solidity Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="solidity-by-example.html">Solidity by Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="solidity-in-depth.html">Solidity in Depth</a></li>
<li class="toctree-l1"><a class="reference internal" href="security-considerations.html">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-the-compiler.html">Using the compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Contract Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html">Contract ABI Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="yul.html">Yul</a></li>
<li class="toctree-l1"><a class="reference internal" href="style-guide.html">Style Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Common Patterns</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#withdrawal-from-contracts">Withdrawal from Contracts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#restricting-access">Restricting Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="#state-machine">State Machine</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bugs.html">List of Known Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="frequently-asked-questions.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="lll.html">LLL</a></li>
</ul>

            
          
    <a href="genindex.html">Keyword Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Solidity</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Common Patterns</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/common-patterns.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="common-patterns">
<h1>Common Patterns<a class="headerlink" href="#common-patterns" title="Permalink to this headline">¶</a></h1>
<div class="section" id="withdrawal-from-contracts">
<span id="withdrawal-pattern"></span><span id="index-0"></span><h2>Withdrawal from Contracts<a class="headerlink" href="#withdrawal-from-contracts" title="Permalink to this headline">¶</a></h2>
<p>発行の後にファンドを送る方法としてお勧めなのはwithdrawalパターンを使うことです。直接 <code class="docutils literal notranslate"><span class="pre">transfer</span></code> コールするのは直感的なEtherの送金方法ですが、潜在的にセキュリティリスクを実装することになるので、推奨しません。これに関しての詳しい情報は、<a class="reference internal" href="security-considerations.html#security-considerations"><span class="std std-ref">Security Considerations</span></a> を読んでください。</p>
<p>次の例はあるコントラクトにおける実際のwithdrawalパターンです。このコントラクトの目的は”richest”（ <a class="reference external" href="https://www.kingoftheether.com/">King of the Ether</a> に触発されました）になるためにたくさんのお金をコントラクトに送ることです。</p>
<p>下記のコントラクトでは、richestの座を奪われたら、新しくrichestになった人のファンドを受け取れます。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">WithdrawalContract</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">richest</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">mostSent</span><span class="p">;</span>

    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">pendingWithdrawals</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="n">richest</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="n">mostSent</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">becomeRichest</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="n">mostSent</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">pendingWithdrawals</span><span class="p">[</span><span class="n">richest</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg.value</span><span class="p">;</span>
            <span class="n">richest</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
            <span class="n">mostSent</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">pendingWithdrawals</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
        <span class="c1">// Remember to zero the pending refund before</span>
        <span class="c1">// sending to prevent re-entrancy attacks</span>
        <span class="n">pendingWithdrawals</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>次は逆にもっと直感的な送金パターンです。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">SendContract</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="kr">payable</span> <span class="kr">public</span> <span class="n">richest</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">mostSent</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="n">richest</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="n">mostSent</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">becomeRichest</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="n">mostSent</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// This line can cause problems (explained below).</span>
            <span class="n">richest</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="nb">msg.value</span><span class="p">);</span>
            <span class="n">richest</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
            <span class="n">mostSent</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>気づいて頂きたいのは、この例では攻撃者が、<code class="docutils literal notranslate"><span class="pre">richest</span></code> に、失敗する（例えば、<code class="docutils literal notranslate"><span class="pre">revert()</span></code> を使ったり、2300ガス以上を消費したりすることで）フォールバックファンクションを持ったコントラクトアドレスを入れることで、通常ではない状態をコントラクトに仕込めるということです。こういう方法によって、”毒された”コントラクトにファンドを送るために <code class="docutils literal notranslate"><span class="pre">transfer</span></code> が呼ばれると常に失敗し、その結果、<code class="docutils literal notranslate"><span class="pre">becomeRichest</span></code> が失敗し、コントラクトは永遠に動かなくなります。</p>
<p>一方、もし最初の例の”withdraw”パターンを使うと、攻撃者は自分のwithdrawの失敗しか起こせないので、他のコントラクトの機能は損なわれません。</p>
</div>
<div class="section" id="restricting-access">
<span id="index-1"></span><h2>Restricting Access<a class="headerlink" href="#restricting-access" title="Permalink to this headline">¶</a></h2>
<p>アクセス制限はコントラクトの共通パターンです。他の人やコンピューターがトランザクションやコントラクトのステートを読み取ることを制限することはできないということを覚えておいてください。暗号化で少し難しくはできますが、もしコントラクトがデータを読み込めるなら、他の人もできます。</p>
<p><strong>他のコントラクト</strong> によるあなたのコントラクトのステートへの読み込みのアクセスは制限できます。状態変数を <code class="docutils literal notranslate"><span class="pre">public</span></code> で宣言しなければ、これはデフォルトでそうなっています。</p>
<p>さらに、誰があなたのコントラクトのステートを変更したり、ファンクションを呼び出したりできるか制限することができます。そしてこれがこのセクションで説明することです。</p>
<p id="index-2"><strong>function modifiers</strong> を使うことでこれらの制限をとても読みやすくします。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">AccessRestriction</span> <span class="p">{</span>
    <span class="c1">// These will be assigned at the construction</span>
    <span class="c1">// phase, where `msg.sender` is the account</span>
    <span class="c1">// creating this contract.</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">creationTime</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>

    <span class="c1">// Modifiers can be used to change</span>
    <span class="c1">// the body of a function.</span>
    <span class="c1">// If this modifier is used, it will</span>
    <span class="c1">// prepend a check that only passes</span>
    <span class="c1">// if the function is called from</span>
    <span class="c1">// a certain address.</span>
    <span class="kd">modifier</span> <span class="n">onlyBy</span><span class="p">(</span><span class="kt">address</span> <span class="n">_account</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">_account</span><span class="p">,</span>
            <span class="s">&quot;Sender not authorized.&quot;</span>
        <span class="p">);</span>
        <span class="c1">// Do not forget the &quot;_;&quot;! It will</span>
        <span class="c1">// be replaced by the actual function</span>
        <span class="c1">// body when the modifier is used.</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// Make `_newOwner` the new owner of this</span>
    <span class="c1">/// contract.</span>
    <span class="kd">function</span> <span class="n">changeOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_newOwner</span><span class="p">)</span>
        <span class="kr">public</span>
        <span class="n">onlyBy</span><span class="p">(</span><span class="n">owner</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="n">_newOwner</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="n">onlyAfter</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_time</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="nb">now</span> <span class="o">&gt;=</span> <span class="n">_time</span><span class="p">,</span>
            <span class="s">&quot;Function called too early.&quot;</span>
        <span class="p">);</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// Erase ownership information.</span>
    <span class="c1">/// May only be called 6 weeks after</span>
    <span class="c1">/// the contract has been created.</span>
    <span class="kd">function</span> <span class="n">disown</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="n">onlyBy</span><span class="p">(</span><span class="n">owner</span><span class="p">)</span>
        <span class="n">onlyAfter</span><span class="p">(</span><span class="n">creationTime</span> <span class="o">+</span> <span class="mi">6</span> <span class="kc">weeks</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">delete</span> <span class="n">owner</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// This modifier requires a certain</span>
    <span class="c1">// fee being associated with a function call.</span>
    <span class="c1">// If the caller sent too much, he or she is</span>
    <span class="c1">// refunded, but only after the function body.</span>
    <span class="c1">// This was dangerous before Solidity version 0.4.0,</span>
    <span class="c1">// where it was possible to skip the part after `_;`.</span>
    <span class="kd">modifier</span> <span class="n">costs</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_amount</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="nb">msg.value</span> <span class="o">&gt;=</span> <span class="n">_amount</span><span class="p">,</span>
            <span class="s">&quot;Not enough Ether provided.&quot;</span>
        <span class="p">);</span>
        <span class="kr">_</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="n">_amount</span><span class="p">)</span>
            <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">-</span> <span class="n">_amount</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">forceOwnerChange</span><span class="p">(</span><span class="kt">address</span> <span class="n">_newOwner</span><span class="p">)</span>
        <span class="kr">public</span>
        <span class="kr">payable</span>
        <span class="n">costs</span><span class="p">(</span><span class="mi">200</span> <span class="kc">ether</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="n">_newOwner</span><span class="p">;</span>
        <span class="c1">// just some example condition</span>
        <span class="k">if</span> <span class="p">(</span><span class="kt">uint</span><span class="p">(</span><span class="n">owner</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">0</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1">// This did not refund for Solidity</span>
            <span class="c1">// before version 0.4.0.</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="c1">// refund overpaid fees</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>どのファンクションコールへのアクセスが制限できるかというもっと特殊な方法は次の例で説明します。</p>
</div>
<div class="section" id="state-machine">
<span id="index-3"></span><h2>State Machine<a class="headerlink" href="#state-machine" title="Permalink to this headline">¶</a></h2>
<p>コントラクトはよくステートマシンとして振舞います。つまり、異なる挙動をする、もしくは異なるファンクションがコールされるいくつかの <strong>ステージ</strong> を持っています。ファンクションコールはしばしばステージを終わらせ、コントラクトを次のステージへ以降させます（特にコントラクトに <strong>相互作用</strong> があった場合）。いくつかのステージは自動的にあるポイントに <strong>そのうちに</strong> なっていることもよくあります。</p>
<p>この例としてブラインドオークションのコントラクトがあります。このコントラクトでは”ブラインドビッドの承認”ステージから始まり、”オークションの結果”で終わる”ビッドの公開”に移行します。</p>
<p id="index-4">このシチュエーションで、ステートを作って、コントラクトの間違った使用法から守るため、ファンクションmodifierを使うことができます。</p>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>次の例では、modifier <code class="docutils literal notranslate"><span class="pre">atStage</span></code> はあるステージの時にのみファンクションが呼ばれるようにすることができます。</p>
<p>自動でのある時間での変遷はmodifier <code class="docutils literal notranslate"><span class="pre">timeTransitions</span></code> でコントロールすることができ、全てのファンクションで使えます。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>modifierの順番は重要です。</strong>
atStageがtimedTransitionsと一緒にする場合、timedTransitionsの後にatStageを付けてください。そうすることで新しいステージが考慮されます。</p>
</div>
<p>最後に、modifier <code class="docutils literal notranslate"><span class="pre">transitionNext</span></code> はファンクションが終わった時に自動的に次のステージに行くために使用できます。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>modifierはスキップされるかもしれません。</strong>
これはSolidityバージョン0.4.0より前にのみ適用されます。modifierはファンクションコールを使うのではなく、単純にコードを別の所に書くことで適用されているので、もしファンクションがreturnを使っていたら、transitionNext内のコードはスキップされるかもしれません。もしスキップさせたくないのであれば、ファンクション内マニュアルでnextStageを呼び出してください。
バージョン0.4.0からはファンクションが明示的にreturnしていても、modifierコードは実行されます。</p>
</div>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">StateMachine</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="n">Stages</span> <span class="p">{</span>
        <span class="n">AcceptingBlindedBids</span><span class="p">,</span>
        <span class="n">RevealBids</span><span class="p">,</span>
        <span class="n">AnotherStage</span><span class="p">,</span>
        <span class="n">AreWeDoneYet</span><span class="p">,</span>
        <span class="n">Finished</span>
    <span class="p">}</span>

    <span class="c1">// This is the current stage.</span>
    <span class="n">Stages</span> <span class="kr">public</span> <span class="n">stage</span> <span class="o">=</span> <span class="n">Stages</span><span class="p">.</span><span class="n">AcceptingBlindedBids</span><span class="p">;</span>

    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">creationTime</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>

    <span class="kd">modifier</span> <span class="n">atStage</span><span class="p">(</span><span class="n">Stages</span> <span class="n">_stage</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="n">stage</span> <span class="o">==</span> <span class="n">_stage</span><span class="p">,</span>
            <span class="s">&quot;Function cannot be called at this time.&quot;</span>
        <span class="p">);</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">nextStage</span><span class="p">()</span> <span class="kr">internal</span> <span class="p">{</span>
        <span class="n">stage</span> <span class="o">=</span> <span class="n">Stages</span><span class="p">(</span><span class="kt">uint</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Perform timed transitions. Be sure to mention</span>
    <span class="c1">// this modifier first, otherwise the guards</span>
    <span class="c1">// will not take the new stage into account.</span>
    <span class="kd">modifier</span> <span class="n">timedTransitions</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">stage</span> <span class="o">==</span> <span class="n">Stages</span><span class="p">.</span><span class="n">AcceptingBlindedBids</span> <span class="o">&amp;&amp;</span>
                    <span class="nb">now</span> <span class="o">&gt;=</span> <span class="n">creationTime</span> <span class="o">+</span> <span class="mi">10</span> <span class="kc">days</span><span class="p">)</span>
            <span class="n">nextStage</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">stage</span> <span class="o">==</span> <span class="n">Stages</span><span class="p">.</span><span class="n">RevealBids</span> <span class="o">&amp;&amp;</span>
                <span class="nb">now</span> <span class="o">&gt;=</span> <span class="n">creationTime</span> <span class="o">+</span> <span class="mi">12</span> <span class="kc">days</span><span class="p">)</span>
            <span class="n">nextStage</span><span class="p">();</span>
        <span class="c1">// The other stages transition by transaction</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Order of the modifiers matters here!</span>
    <span class="kd">function</span> <span class="n">bid</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="kr">payable</span>
        <span class="n">timedTransitions</span>
        <span class="n">atStage</span><span class="p">(</span><span class="n">Stages</span><span class="p">.</span><span class="n">AcceptingBlindedBids</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// We will not implement that here</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">reveal</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="n">timedTransitions</span>
        <span class="n">atStage</span><span class="p">(</span><span class="n">Stages</span><span class="p">.</span><span class="n">RevealBids</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="c1">// This modifier goes to the next stage</span>
    <span class="c1">// after the function is done.</span>
    <span class="kd">modifier</span> <span class="n">transitionNext</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kr">_</span><span class="p">;</span>
        <span class="n">nextStage</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">g</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="n">timedTransitions</span>
        <span class="n">atStage</span><span class="p">(</span><span class="n">Stages</span><span class="p">.</span><span class="n">AnotherStage</span><span class="p">)</span>
        <span class="n">transitionNext</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">h</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="n">timedTransitions</span>
        <span class="n">atStage</span><span class="p">(</span><span class="n">Stages</span><span class="p">.</span><span class="n">AreWeDoneYet</span><span class="p">)</span>
        <span class="n">transitionNext</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">i</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="n">timedTransitions</span>
        <span class="n">atStage</span><span class="p">(</span><span class="n">Stages</span><span class="p">.</span><span class="n">Finished</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bugs.html" class="btn btn-neutral float-right" title="List of Known Bugs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="style-guide.html" class="btn btn-neutral float-left" title="Style Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2019, Ethereum

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>