

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Contributing &mdash; Solidity 0.5.4 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="よくある質問" href="frequently-asked-questions.html" />
    <link rel="prev" title="既知のバグ" href="bugs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Solidity
          

          
          </a>

          
            
            
              <div class="version">
                0.5.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction-to-smart-contracts.html">Introduction to Smart Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing-solidity.html">Solidityをインストールする</a></li>
<li class="toctree-l1"><a class="reference internal" href="solidity-by-example.html">Solidity by Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="solidity-in-depth.html">Solidity in Depth</a></li>
<li class="toctree-l1"><a class="reference internal" href="security-considerations.html">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-the-compiler.html">Using the compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">コントラクトメタデータ</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html">Contract ABI Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="yul.html">Yul</a></li>
<li class="toctree-l1"><a class="reference internal" href="style-guide.html">Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-patterns.html">Common Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="bugs.html">既知のバグ</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#how-to-report-issues">How to Report Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="#workflow-for-pull-requests">Workflow for Pull Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-compiler-tests">Running the compiler tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#writing-and-running-syntax-tests">Writing and running syntax tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-fuzzer-via-afl">Running the Fuzzer via AFL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#whiskers">Whiskers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="frequently-asked-questions.html">よくある質問</a></li>
<li class="toctree-l1"><a class="reference internal" href="lll.html">LLL</a></li>
</ul>

            
          
    <a href="genindex.html">Keyword Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Solidity</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Contributing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/contributing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="contributing">
<h1>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h1>
<p>Help is always appreciated!</p>
<p>To get started, you can try <a class="reference internal" href="installing-solidity.html#building-from-source"><span class="std std-ref">Building from Source</span></a> in order to familiarize
yourself with the components of Solidity and the build process. Also, it may be
useful to become well-versed at writing smart-contracts in Solidity.</p>
<p>In particular, we need help in the following areas:</p>
<ul class="simple">
<li>Improving the documentation</li>
<li>Responding to questions from other users on <a class="reference external" href="https://ethereum.stackexchange.com">StackExchange</a> and the <a class="reference external" href="https://gitter.im/ethereum/solidity">Solidity Gitter</a></li>
<li>Fixing and responding to <a class="reference external" href="https://github.com/ethereum/solidity/issues">Solidity’s GitHub issues</a>, especially those tagged as
<a class="reference external" href="https://github.com/ethereum/solidity/labels/good%20first%20issue">good first issue</a> which are
meant as introductory issues for external contributors.</li>
</ul>
<p>Please note that this project is released with a <a class="reference external" href="https://raw.githubusercontent.com/ethereum/solidity/develop/CODE_OF_CONDUCT.md">Contributor Code of Conduct</a>. By participating in this project - in the issues, pull requests, or Gitter channels - you agree to abide by its terms.</p>
<div class="section" id="how-to-report-issues">
<h2>How to Report Issues<a class="headerlink" href="#how-to-report-issues" title="Permalink to this headline">¶</a></h2>
<p>To report an issue, please use the
<a class="reference external" href="https://github.com/ethereum/solidity/issues">GitHub issues tracker</a>. When
reporting issues, please mention the following details:</p>
<ul class="simple">
<li>Which version of Solidity you are using</li>
<li>What was the source code (if applicable)</li>
<li>Which platform are you running on</li>
<li>How to reproduce the issue</li>
<li>What was the result of the issue</li>
<li>What the expected behaviour is</li>
</ul>
<p>Reducing the source code that caused the issue to a bare minimum is always
very helpful and sometimes even clarifies a misunderstanding.</p>
</div>
<div class="section" id="workflow-for-pull-requests">
<h2>Workflow for Pull Requests<a class="headerlink" href="#workflow-for-pull-requests" title="Permalink to this headline">¶</a></h2>
<p>In order to contribute, please fork off of the <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch and make your
changes there. Your commit messages should detail <em>why</em> you made your change
in addition to <em>what</em> you did (unless it is a tiny change).</p>
<p>If you need to pull in any changes from <code class="docutils literal notranslate"><span class="pre">develop</span></code> after making your fork (for
example, to resolve potential merge conflicts), please avoid using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">merge</span></code>
and instead, <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rebase</span></code> your branch. This will help us review your change
more easily.</p>
<p>Additionally, if you are writing a new feature, please ensure you add appropriate
test cases under <code class="docutils literal notranslate"><span class="pre">test/</span></code> (see below).</p>
<p>However, if you are making a larger change, please consult with the <a class="reference external" href="https://gitter.im/ethereum/solidity-dev">Solidity Development Gitter channel</a> (different from the one mentioned above, this one is
focused on compiler and language development instead of language use) first.</p>
<p>New features and bugfixes should be added to the <code class="docutils literal notranslate"><span class="pre">Changelog.md</span></code> file: please
follow the style of previous entries, when applicable.</p>
<p>Finally, please make sure you respect the <a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/CODING_STYLE.md">coding style</a>
for this project. Also, even though we do CI testing, please test your code and
ensure that it builds locally before submitting a pull request.</p>
<p>Thank you for your help!</p>
</div>
<div class="section" id="running-the-compiler-tests">
<h2>Running the compiler tests<a class="headerlink" href="#running-the-compiler-tests" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">./scripts/tests.sh</span></code> script executes most Solidity tests and
runs <code class="docutils literal notranslate"><span class="pre">aleth</span></code> automatically if it is in the path, but does not download it,
so you need to install it first. Please read on for the details.</p>
<p>Solidity includes different types of tests, most of them bundled into the <code class="docutils literal notranslate"><span class="pre">soltest</span></code>
application. Some of them require the <code class="docutils literal notranslate"><span class="pre">aleth</span></code> client in testing mode, others require <code class="docutils literal notranslate"><span class="pre">libz3</span></code>.</p>
<p>To run a basic set of tests that require neither <code class="docutils literal notranslate"><span class="pre">aleth</span></code> nor <code class="docutils literal notranslate"><span class="pre">libz3</span></code>, run
<code class="docutils literal notranslate"><span class="pre">./scripts/soltest.sh</span> <span class="pre">--no-ipc</span> <span class="pre">--no-smt</span></code>. This script runs <code class="docutils literal notranslate"><span class="pre">./build/test/soltest</span></code>
internally.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Those working in a Windows environment wanting to run the above basic sets without aleth or libz3 in Git Bash, you would have to do: <code class="docutils literal notranslate"><span class="pre">./build/test/Release/soltest.exe</span> <span class="pre">--</span> <span class="pre">--no-ipc</span> <span class="pre">--no-smt</span></code>.
If you’re running this in plain Command Prompt, use <code class="docutils literal notranslate"><span class="pre">.\build\test\Release\soltest.exe</span> <span class="pre">--</span> <span class="pre">--no-ipc</span> <span class="pre">--no-smt</span></code>.</p>
</div>
<p>The option <code class="docutils literal notranslate"><span class="pre">--no-smt</span></code> disables the tests that require <code class="docutils literal notranslate"><span class="pre">libz3</span></code> and
<code class="docutils literal notranslate"><span class="pre">--no-ipc</span></code> disables those that require <code class="docutils literal notranslate"><span class="pre">aleth</span></code>.</p>
<p>If you want to run the ipc tests (that test the semantics of the generated code),
you need to install <a class="reference external" href="https://github.com/ethereum/aleth/releases/download/v1.5.0-alpha.7/aleth-1.5.0-alpha.7-linux-x86_64.tar.gz">aleth</a> and run it in testing mode: <code class="docutils literal notranslate"><span class="pre">aleth</span> <span class="pre">--db</span> <span class="pre">memorydb</span> <span class="pre">--test</span> <span class="pre">-d</span> <span class="pre">/tmp/testeth</span></code>.</p>
<p>To run the actual tests, use: <code class="docutils literal notranslate"><span class="pre">./scripts/soltest.sh</span> <span class="pre">--ipcpath</span> <span class="pre">/tmp/testeth/geth.ipc</span></code>.</p>
<p>To run a subset of tests, you can use filters:
<code class="docutils literal notranslate"><span class="pre">./scripts/soltest.sh</span> <span class="pre">-t</span> <span class="pre">TestSuite/TestName</span> <span class="pre">--ipcpath</span> <span class="pre">/tmp/testeth/geth.ipc</span></code>,
where <code class="docutils literal notranslate"><span class="pre">TestName</span></code> can be a wildcard <code class="docutils literal notranslate"><span class="pre">*</span></code>.</p>
<p>For example, here’s an example test you might run;
<code class="docutils literal notranslate"><span class="pre">./scripts/soltest.sh</span> <span class="pre">-t</span> <span class="pre">&quot;yulOptimizerTests/disambiguator/*&quot;</span> <span class="pre">--no-ipc</span> <span class="pre">--no-smt</span></code>.
This will test all the tests for the disambiguator.</p>
<p>To get a list of all tests, use
<code class="docutils literal notranslate"><span class="pre">./build/test/soltest</span> <span class="pre">--list_content=HRF</span> <span class="pre">--</span> <span class="pre">--ipcpath</span> <span class="pre">/tmp/irrelevant</span></code>.</p>
<p>If you want to debug using GDB, make sure you build differently than the “usual”.
For example, you could run the following command in your <code class="docutils literal notranslate"><span class="pre">build</span></code> folder:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">-</span><span class="n">DCMAKE_BUILD_TYPE</span><span class="o">=</span><span class="n">Debug</span> <span class="p">..</span>
<span class="n">make</span>
</pre></div>
</div>
<p>This will create symbols such that when you debug a test using the <code class="docutils literal notranslate"><span class="pre">--debug</span></code> flag, you will have access to functions and variables in which you can break or print with.</p>
<p>The script <code class="docutils literal notranslate"><span class="pre">./scripts/tests.sh</span></code> also runs commandline tests and compilation tests
in addition to those found in <code class="docutils literal notranslate"><span class="pre">soltest</span></code>.</p>
<p>The CI runs additional tests (including <code class="docutils literal notranslate"><span class="pre">solc-js</span></code> and testing third party Solidity frameworks) that require compiling the Emscripten target.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some versions of <code class="docutils literal notranslate"><span class="pre">aleth</span></code> can not be used for testing. We suggest using
the same version that the Solidity continuous integration tests use.
Currently the CI uses version <code class="docutils literal notranslate"><span class="pre">1.5.0-alpha.7</span></code> of <code class="docutils literal notranslate"><span class="pre">aleth</span></code>.</p>
</div>
<div class="section" id="writing-and-running-syntax-tests">
<h3>Writing and running syntax tests<a class="headerlink" href="#writing-and-running-syntax-tests" title="Permalink to this headline">¶</a></h3>
<p>Syntax tests check that the compiler generates the correct error messages for invalid code
and properly accepts valid code.
They are stored in individual files inside the <code class="docutils literal notranslate"><span class="pre">tests/libsolidity/syntaxTests</span></code> folder.
These files must contain annotations, stating the expected result(s) of the respective test.
The test suite compiles and checks them against the given expectations.</p>
<p>For example: <code class="docutils literal notranslate"><span class="pre">./test/libsolidity/syntaxTests/double_stateVariable_declaration.sol</span></code></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">test</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="n">variable</span><span class="p">;</span>
    <span class="kt">uint128</span> <span class="n">variable</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// ----</span>
<span class="c1">// DeclarationError: (36-52): Identifier already declared.</span>
</pre></div>
</div>
<p>A syntax test must contain at least the contract under test itself, followed by the separator <code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">----</span></code>. The comments that follow the separator are used to describe the
expected compiler errors or warnings. The number range denotes the location in the source where the error occurred.
If you want the contract to compile without any errors or warning you can leave
out the separator and the comments that follow it.</p>
<p>In the above example, the state variable <code class="docutils literal notranslate"><span class="pre">variable</span></code> was declared twice, which is not allowed. This results in a <code class="docutils literal notranslate"><span class="pre">DeclarationError</span></code> stating that the identifier was already declared.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">isoltest</span></code> tool is used for these tests and you can find it under <code class="docutils literal notranslate"><span class="pre">./build/test/tools/</span></code>. It is an interactive tool which allows
editing of failing contracts using your preferred text editor. Let’s try to break this test by removing the second declaration of <code class="docutils literal notranslate"><span class="pre">variable</span></code>:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">test</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="n">variable</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// ----</span>
<span class="c1">// DeclarationError: (36-52): Identifier already declared.</span>
</pre></div>
</div>
<p>Running <code class="docutils literal notranslate"><span class="pre">./build/test/isoltest</span></code> again results in a test failure:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">syntaxTests</span><span class="o">/</span><span class="n">double_stateVariable_declaration</span><span class="p">.</span><span class="n">sol</span><span class="o">:</span> <span class="n">FAIL</span>
    <span class="n">Contract</span><span class="o">:</span>
        <span class="kd">contract</span> <span class="n">test</span> <span class="p">{</span>
            <span class="kt">uint256</span> <span class="n">variable</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="n">Expected</span> <span class="n">result</span><span class="o">:</span>
        <span class="n">DeclarationError</span><span class="o">:</span> <span class="p">(</span><span class="mi">36</span><span class="o">-</span><span class="mi">52</span><span class="p">)</span><span class="o">:</span> <span class="n">Identifier</span> <span class="n">already</span> <span class="n">declared</span><span class="p">.</span>
    <span class="n">Obtained</span> <span class="n">result</span><span class="o">:</span>
        <span class="n">Success</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">isoltest</span></code> prints the expected result next to the obtained result, and also
provides a way to edit, update or skip the current contract file, or quit the application.</p>
<p>It offers several options for failing tests:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">edit</span></code>: <code class="docutils literal notranslate"><span class="pre">isoltest</span></code> tries to open the contract in an editor so you can adjust it. It either uses the editor given on the command line (as <code class="docutils literal notranslate"><span class="pre">isoltest</span> <span class="pre">--editor</span> <span class="pre">/path/to/editor</span></code>), in the environment variable <code class="docutils literal notranslate"><span class="pre">EDITOR</span></code> or just <code class="docutils literal notranslate"><span class="pre">/usr/bin/editor</span></code> (in that order).</li>
<li><code class="docutils literal notranslate"><span class="pre">update</span></code>: Updates the expectations for contract under test. This updates the annotations by removing unmet expectations and adding missing expectations. The test is then run again.</li>
<li><code class="docutils literal notranslate"><span class="pre">skip</span></code>: Skips the execution of this particular test.</li>
<li><code class="docutils literal notranslate"><span class="pre">quit</span></code>: Quits <code class="docutils literal notranslate"><span class="pre">isoltest</span></code>.</li>
</ul>
<p>All of these options apply to the current contract, expect <code class="docutils literal notranslate"><span class="pre">quit</span></code> which stops the entire testing process.</p>
<p>Automatically updating the test above changes it to</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">test</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="n">variable</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// ----</span>
</pre></div>
</div>
<p>and re-run the test. It now passes again:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">Re</span><span class="o">-</span><span class="n">running</span> <span class="n">test</span> <span class="n">case</span><span class="p">...</span>
<span class="n">syntaxTests</span><span class="o">/</span><span class="n">double_stateVariable_declaration</span><span class="p">.</span><span class="n">sol</span><span class="o">:</span> <span class="n">OK</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Choose a name for the contract file that explains what it tests, e.g. <code class="docutils literal notranslate"><span class="pre">double_variable_declaration.sol</span></code>.
Do not put more than one contract into a single file, unless you are testing inheritance or cross-contract calls.
Each file should test one aspect of your new feature.</p>
</div>
</div>
</div>
<div class="section" id="running-the-fuzzer-via-afl">
<h2>Running the Fuzzer via AFL<a class="headerlink" href="#running-the-fuzzer-via-afl" title="Permalink to this headline">¶</a></h2>
<p>Fuzzing is a technique that runs programs on more or less random inputs to find exceptional execution
states (segmentation faults, exceptions, etc). Modern fuzzers are clever and run a directed search
inside the input. We have a specialized binary called <code class="docutils literal notranslate"><span class="pre">solfuzzer</span></code> which takes source code as input
and fails whenever it encounters an internal compiler error, segmentation fault or similar, but
does not fail if e.g., the code contains an error. This way, fuzzing tools can find internal problems in the compiler.</p>
<p>We mainly use <a class="reference external" href="http://lcamtuf.coredump.cx/afl/">AFL</a> for fuzzing. You need to download and
install the AFL packages from your repositories (afl, afl-clang) or build them manually.
Next, build Solidity (or just the <code class="docutils literal notranslate"><span class="pre">solfuzzer</span></code> binary) with AFL as your compiler:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">build</span>
<span class="err">#</span> <span class="k">if</span> <span class="n">needed</span>
<span class="n">make</span> <span class="n">clean</span>
<span class="n">cmake</span> <span class="p">..</span> <span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">afl</span><span class="o">-</span><span class="n">gcc</span> <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">afl</span><span class="o">-</span><span class="n">g</span><span class="o">++</span>
<span class="n">make</span> <span class="n">solfuzzer</span>
</pre></div>
</div>
<p>At this stage you should be able to see a message similar to the following:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">Scanning</span> <span class="n">dependencies</span> <span class="n">of</span> <span class="n">target</span> <span class="n">solfuzzer</span>
<span class="p">[</span> <span class="mi">98</span><span class="o">%</span><span class="p">]</span> <span class="n">Building</span> <span class="n">CXX</span> <span class="n">object</span> <span class="n">test</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">CMakeFiles</span><span class="o">/</span><span class="n">solfuzzer</span><span class="p">.</span><span class="n">dir</span><span class="o">/</span><span class="n">fuzzer</span><span class="p">.</span><span class="n">cpp</span><span class="p">.</span><span class="n">o</span>
<span class="n">afl</span><span class="o">-</span><span class="n">cc</span> <span class="mf">2.52</span><span class="n">b</span> <span class="n">by</span> <span class="o">&lt;</span><span class="n">lcamtuf</span><span class="err">@</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">afl</span><span class="o">-</span><span class="kr">as</span> <span class="mf">2.52</span><span class="n">b</span> <span class="n">by</span> <span class="o">&lt;</span><span class="n">lcamtuf</span><span class="err">@</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Instrumented</span> <span class="mi">1949</span> <span class="n">locations</span> <span class="p">(</span><span class="mi">64</span><span class="o">-</span><span class="n">bit</span><span class="p">,</span> <span class="n">non</span><span class="o">-</span><span class="n">hardened</span> <span class="n">mode</span><span class="p">,</span> <span class="n">ratio</span> <span class="mi">100</span><span class="o">%</span><span class="p">).</span>
<span class="p">[</span><span class="mi">100</span><span class="o">%</span><span class="p">]</span> <span class="n">Linking</span> <span class="n">CXX</span> <span class="n">executable</span> <span class="n">solfuzzer</span>
</pre></div>
</div>
<p>If the instrumentation messages did not appear, try switching the cmake flags pointing to AFL’s clang binaries:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="err">#</span> <span class="k">if</span> <span class="n">previously</span> <span class="n">failed</span>
<span class="n">make</span> <span class="n">clean</span>
<span class="n">cmake</span> <span class="p">..</span> <span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">afl</span><span class="o">-</span><span class="n">clang</span> <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">afl</span><span class="o">-</span><span class="n">clang</span><span class="o">++</span>
<span class="n">make</span> <span class="n">solfuzzer</span>
</pre></div>
</div>
<p>Otherwise, upon execution the fuzzer halts with an error saying binary is not instrumented:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">afl</span><span class="o">-</span><span class="n">fuzz</span> <span class="mf">2.52</span><span class="n">b</span> <span class="n">by</span> <span class="o">&lt;</span><span class="n">lcamtuf</span><span class="err">@</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="p">...</span> <span class="p">(</span><span class="n">truncated</span> <span class="n">messages</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Validating</span> <span class="n">target</span> <span class="n">binary</span><span class="p">...</span>

<span class="p">[</span><span class="o">-</span><span class="p">]</span> <span class="n">Looks</span> <span class="n">like</span> <span class="n">the</span> <span class="n">target</span> <span class="n">binary</span> <span class="kr">is</span> <span class="n">not</span> <span class="n">instrumented</span><span class="o">!</span> <span class="n">The</span> <span class="n">fuzzer</span> <span class="n">depends</span> <span class="n">on</span>
    <span class="n">compile</span><span class="o">-</span><span class="n">time</span> <span class="n">instrumentation</span> <span class="n">to</span> <span class="n">isolate</span> <span class="n">interesting</span> <span class="n">test</span> <span class="n">cases</span> <span class="k">while</span>
    <span class="n">mutating</span> <span class="n">the</span> <span class="n">input</span> <span class="n">data</span><span class="p">.</span> <span class="n">For</span> <span class="n">more</span> <span class="n">information</span><span class="p">,</span> <span class="n">and</span> <span class="k">for</span> <span class="n">tips</span> <span class="n">on</span> <span class="n">how</span> <span class="n">to</span>
    <span class="n">instrument</span> <span class="n">binaries</span><span class="p">,</span> <span class="n">please</span> <span class="n">see</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">afl</span><span class="o">-</span><span class="n">doc</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">README</span><span class="p">.</span>

    <span class="n">When</span> <span class="n">source</span> <span class="n">code</span> <span class="kr">is</span> <span class="n">not</span> <span class="n">available</span><span class="p">,</span> <span class="n">you</span> <span class="n">may</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span> <span class="n">leverage</span> <span class="n">QEMU</span>
    <span class="n">mode</span> <span class="n">support</span><span class="p">.</span> <span class="n">Consult</span> <span class="n">the</span> <span class="n">README</span> <span class="k">for</span> <span class="n">tips</span> <span class="n">on</span> <span class="n">how</span> <span class="n">to</span> <span class="n">enable</span> <span class="nb">this</span><span class="p">.</span>
    <span class="p">(</span><span class="n">It</span> <span class="kr">is</span> <span class="n">also</span> <span class="n">possible</span> <span class="n">to</span> <span class="n">use</span> <span class="n">afl</span><span class="o">-</span><span class="n">fuzz</span> <span class="kr">as</span> <span class="n">a</span> <span class="n">traditional</span><span class="p">,</span> <span class="s">&quot;dumb&quot;</span> <span class="n">fuzzer</span><span class="p">.</span>
    <span class="n">For</span> <span class="n">that</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">use</span> <span class="n">the</span> <span class="o">-</span><span class="n">n</span> <span class="n">option</span> <span class="o">-</span> <span class="n">but</span> <span class="n">expect</span> <span class="n">much</span> <span class="n">worse</span> <span class="n">results</span><span class="p">.)</span>

<span class="p">[</span><span class="o">-</span><span class="p">]</span> <span class="n">PROGRAM</span> <span class="n">ABORT</span> <span class="o">:</span> <span class="n">No</span> <span class="n">instrumentation</span> <span class="n">detected</span>
         <span class="n">Location</span> <span class="o">:</span> <span class="n">check_binary</span><span class="p">(),</span> <span class="n">afl</span><span class="o">-</span><span class="n">fuzz</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">6920</span>
</pre></div>
</div>
<p>Next, you need some example source files. This makes it much easier for the fuzzer
to find errors. You can either copy some files from the syntax tests or extract test files
from the documentation or the other tests:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">test_cases</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">test_cases</span>
<span class="err">#</span> <span class="n">extract</span> <span class="kr">from</span> <span class="n">tests</span><span class="o">:</span>
<span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">solidity</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">isolate_tests</span><span class="p">.</span><span class="n">py</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">solidity</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">libsolidity</span><span class="o">/</span><span class="n">SolidityEndToEndTest</span><span class="p">.</span><span class="n">cpp</span>
<span class="err">#</span> <span class="n">extract</span> <span class="kr">from</span> <span class="n">documentation</span><span class="o">:</span>
<span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">solidity</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">isolate_tests</span><span class="p">.</span><span class="n">py</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">solidity</span><span class="o">/</span><span class="n">docs</span> <span class="n">docs</span>
</pre></div>
</div>
<p>The AFL documentation states that the corpus (the initial input files) should not be
too large. The files themselves should not be larger than 1 kB and there should be
at most one input file per functionality, so better start with a small number of.
There is also a tool called <code class="docutils literal notranslate"><span class="pre">afl-cmin</span></code> that can trim input files
that result in similar behaviour of the binary.</p>
<p>Now run the fuzzer (the <code class="docutils literal notranslate"><span class="pre">-m</span></code> extends the size of memory to 60 MB):</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">afl</span><span class="o">-</span><span class="n">fuzz</span> <span class="o">-</span><span class="n">m</span> <span class="mi">60</span> <span class="o">-</span><span class="n">i</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">test_cases</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">fuzzer_reports</span> <span class="o">--</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">solfuzzer</span>
</pre></div>
</div>
<p>The fuzzer creates source files that lead to failures in <code class="docutils literal notranslate"><span class="pre">/tmp/fuzzer_reports</span></code>.
Often it finds many similar source files that produce the same error. You can
use the tool <code class="docutils literal notranslate"><span class="pre">scripts/uniqueErrors.sh</span></code> to filter out the unique errors.</p>
</div>
<div class="section" id="whiskers">
<h2>Whiskers<a class="headerlink" href="#whiskers" title="Permalink to this headline">¶</a></h2>
<p><em>Whiskers</em> is a string templating system similar to <a class="reference external" href="https://mustache.github.io">Mustache</a>. It is used by the
compiler in various places to aid readability, and thus maintainability and verifiability, of the code.</p>
<p>The syntax comes with a substantial difference to Mustache. The template markers <code class="docutils literal notranslate"><span class="pre">{{</span></code> and <code class="docutils literal notranslate"><span class="pre">}}</span></code> are
replaced by <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> in order to aid parsing and avoid conflicts with <a class="reference internal" href="assembly.html#inline-assembly"><span class="std std-ref">Inline Assembly</span></a>
(The symbols <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> are invalid in inline assembly, while <code class="docutils literal notranslate"><span class="pre">{</span></code> and <code class="docutils literal notranslate"><span class="pre">}</span></code> are used to delimit blocks).
Another limitation is that lists are only resolved one depth and they do not recurse. This may change in the future.</p>
<p>A rough specification is the following:</p>
<p>Any occurrence of <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> is replaced by the string-value of the supplied variable <code class="docutils literal notranslate"><span class="pre">name</span></code> without any
escaping and without iterated replacements. An area can be delimited by <code class="docutils literal notranslate"><span class="pre">&lt;#name&gt;...&lt;/name&gt;</span></code>. It is replaced
by as many concatenations of its contents as there were sets of variables supplied to the template system,
each time replacing any <code class="docutils literal notranslate"><span class="pre">&lt;inner&gt;</span></code> items by their respective value. Top-level variables can also be used
inside such areas.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="frequently-asked-questions.html" class="btn btn-neutral float-right" title="よくある質問" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="bugs.html" class="btn btn-neutral float-left" title="既知のバグ" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2019, Ethereum

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>