

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Expressions and Control Structures &mdash; Solidity 0.5.4 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contracts" href="contracts.html" />
    <link rel="prev" title="Units and Globally Available Variables" href="units-and-global-variables.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Solidity
          

          
          </a>

          
            
            
              <div class="version">
                0.5.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction-to-smart-contracts.html">Introduction to Smart Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing-solidity.html">Installing the Solidity Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="solidity-by-example.html">Solidity by Example</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="solidity-in-depth.html">Solidity in Depth</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="layout-of-source-files.html">Layout of a Solidity Source File</a></li>
<li class="toctree-l2"><a class="reference internal" href="structure-of-a-contract.html">Structure of a Contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="units-and-global-variables.html">Units and Globally Available Variables</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Expressions and Control Structures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#control-structures">Control Structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#function-calls">Function Calls</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#internal-function-calls">Internal Function Calls</a></li>
<li class="toctree-l4"><a class="reference internal" href="#external-function-calls">External Function Calls</a></li>
<li class="toctree-l4"><a class="reference internal" href="#named-calls-and-anonymous-function-parameters">Named Calls and Anonymous Function Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#omitted-function-parameter-names">Omitted Function Parameter Names</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#creating-contracts-via-new">Creating Contracts via <code class="docutils literal notranslate"><span class="pre">new</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#order-of-evaluation-of-expressions">Order of Evaluation of Expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assignment">Assignment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#destructuring-assignments-and-returning-multiple-values">Destructuring Assignments and Returning Multiple Values</a></li>
<li class="toctree-l4"><a class="reference internal" href="#complications-for-arrays-and-structs">Complications for Arrays and Structs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#scoping-and-declarations">Scoping and Declarations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#error-handling-assert-require-revert-and-exceptions">Error handling: Assert, Require, Revert and Exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="contracts.html">Contracts</a></li>
<li class="toctree-l2"><a class="reference internal" href="assembly.html">Solidity Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="miscellaneous.html">Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="050-breaking-changes.html">Solidity v0.5.0 Breaking Changes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="security-considerations.html">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-the-compiler.html">Using the compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">コントラクトメタデータ</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html">Basic Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html#function-selector">Function selector</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html#argument-encoding">Argument Encoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html#types">Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html#design-criteria-for-the-encoding">Design Criteria for the Encoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html#formal-specification-of-the-encoding">Formal Specification of the Encoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html#function-selector-and-argument-encoding">Function Selector and Argument Encoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html#examples">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html#use-of-dynamic-types">Use of Dynamic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html#events">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html#json">JSON</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html#strict-encoding-mode">Strict Encoding Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html#non-standard-packed-mode">Non-standard Packed Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="yul.html">Yul</a></li>
<li class="toctree-l1"><a class="reference internal" href="style-guide.html">Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-patterns.html">Common Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="bugs.html">既知のバグ</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">貢献</a></li>
<li class="toctree-l1"><a class="reference internal" href="frequently-asked-questions.html">よくある質問</a></li>
<li class="toctree-l1"><a class="reference internal" href="lll.html">LLL</a></li>
</ul>

            
          
    <a href="genindex.html">Keyword Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Solidity</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="solidity-in-depth.html">Solidity in Depth</a> &raquo;</li>
        
      <li>Expressions and Control Structures</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/control-structures.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="expressions-and-control-structures">
<h1>Expressions and Control Structures<a class="headerlink" href="#expressions-and-control-structures" title="Permalink to this headline">¶</a></h1>
<span class="target" id="index-0"></span><div class="section" id="control-structures">
<span id="index-1"></span><h2>Control Structures<a class="headerlink" href="#control-structures" title="Permalink to this headline">¶</a></h2>
<p>Curly-braces languageで使われる様な制御構造のほとんどはSolidityでも使用可能です:</p>
<p>CやJavaScriptで知られる通常のセマンティクスに加えて、<code class="docutils literal notranslate"><span class="pre">if</span></code>、<code class="docutils literal notranslate"><span class="pre">else</span></code>、<code class="docutils literal notranslate"><span class="pre">while</span></code>、<code class="docutils literal notranslate"><span class="pre">do</span></code>、<code class="docutils literal notranslate"><span class="pre">for</span></code>、<code class="docutils literal notranslate"><span class="pre">break</span></code>、<code class="docutils literal notranslate"><span class="pre">continue</span></code>、<code class="docutils literal notranslate"><span class="pre">return</span></code> があります。</p>
<p>条件文では括弧は省略できませんが、単文の周りの波括弧は省略可能です。</p>
<p>CやJavaScriptの様に非ブーリアンをブーリアンに変換することはできません。つまり <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(1)</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> はSolidityでは有効ではありません。</p>
</div>
<div class="section" id="function-calls">
<span id="index-2"></span><span id="id1"></span><h2>Function Calls<a class="headerlink" href="#function-calls" title="Permalink to this headline">¶</a></h2>
<div class="section" id="internal-function-calls">
<span id="id2"></span><h3>Internal Function Calls<a class="headerlink" href="#internal-function-calls" title="Permalink to this headline">¶</a></h3>
<p>現在のコントラクトのファンクションは直接（”内部的に”）呼び出すことができます。また、下記の無意味な例の様に再帰的に呼び出すこともできます。:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">g</span><span class="p">(</span><span class="kt">uint</span> <span class="n">a</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">ret</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">f</span><span class="p">();</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">ret</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">g</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>これらのファンクションの呼び出しはEVM内部で単純なジャンプとして変換されます。これには現在のメモリがクリアされないという影響があります。例えば、メモリの参照を内部で呼ばれたファンクションに渡すことは非常に効率的です。同じコントラクトのファンクションのみが内部的に呼び出すことが可能です。</p>
<p>全てのinternalファンクションの呼び出しは少なくとも1つのスタックのスロットを使い、最大で1024個しかそのスロットは使えないので、余計な再帰処理は避けたほうが良いでしょう。</p>
</div>
<div class="section" id="external-function-calls">
<span id="id3"></span><h3>External Function Calls<a class="headerlink" href="#external-function-calls" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">this.g(8);</span></code> と <code class="docutils literal notranslate"><span class="pre">c.g(2);</span></code> という表現（<code class="docutils literal notranslate"><span class="pre">c</span></code> はコントラクトのインスタンス）も有効なファンクションの呼び出しですが、今回はファンクションは直接ジャンプするのではなく、メッセージコールを通じて “外部的に” 呼び出されます。
実際のコントラクトは未だ作られていないため、<code class="docutils literal notranslate"><span class="pre">this</span></code> でのファンクションの呼び出しはコンストラクタでは使用することができないということを覚えておいてください。</p>
<p>他のコントラクトのファンクションは外部的に呼び出す必要があります。外部コールに関して、全てのファンクションの引数はmemoryにコピーされなければいけません。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">あるコントラクトから別のコントラクトへのファンクションコールはトランザクションを生成しません。トランザクション全体の一部としてのメッセージコールとなります。</p>
</div>
<p>他のコントラクトのファンクションを呼び出すときに、送るWeiの量やガスを特別なオプション <code class="docutils literal notranslate"><span class="pre">.value()</span></code> と <code class="docutils literal notranslate"><span class="pre">.gas()</span></code> を使ってそれぞれ決めることができます。送ったWeiは全てコントラクトのトータルバランスに追加されます。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">InfoFeed</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">info</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">ret</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">42</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Consumer</span> <span class="p">{</span>
    <span class="n">InfoFeed</span> <span class="n">feed</span><span class="p">;</span>
    <span class="kd">function</span> <span class="n">setFeed</span><span class="p">(</span><span class="n">InfoFeed</span> <span class="n">addr</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span> <span class="n">feed</span> <span class="o">=</span> <span class="n">addr</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="n">callFeed</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span> <span class="n">feed</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="n">gas</span><span class="p">(</span><span class="mi">800</span><span class="p">)();</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">info</span></code> ファンクションではmodifierの <code class="docutils literal notranslate"><span class="pre">payable</span></code> を使う必要があります。使わない場合、<code class="docutils literal notranslate"><span class="pre">.value()</span></code> オプションが使えません。</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">feed.info.value(10).gas(800)</span></code> は <code class="docutils literal notranslate"><span class="pre">value</span></code> とファンクションコールと一緒に送信される <code class="docutils literal notranslate"><span class="pre">gas</span></code> 量をローカルにセットするだけです。そして、最後の括弧が実際にファンクションをコールしています。そのため、このケースではファンクションは呼ばれていません。</p>
</div>
<p>呼ばれたコントラクトが存在しない場合（アカウントがコードを含んでいない場合）、もしくは呼ばれたコントラクト自体がエラーを投げた場合、ガス不足の場合にはファンクションが呼ばれると例外が発生します。</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">他のコントラクトのやり取りは、潜在的な危険をはらんでいます。特に、事前にそのコントラクトのソースコードを知らなかった場合には危険です。現在のコントラクトは呼ばれたコントラクトにコントロールを渡すと、潜在的には何でもできてしまうかもしれません。たとえ呼ばれたコントラクトが既知の親コントラクトを継承していたとしても、継承したコントラクトは正しいインターフェースを持てば良いだけです。しかし、そのコントラクトの実行は完全に任意ですので、危険をもたらします。また、そのコントラクトがあなたのシステムの他のコントラクトを呼び出したり、初めの呼び出しが帰って来る前に呼び出し元のコントラクトを呼び返す様な事態に備えてください。つまり呼ばれたコントラクトはファンクションを通じて呼び出し元のコントラクトの状態変数を変えることができます。例えば、コントラクト内の状態変数の変更の後に外部のファンクションを呼び出すような形でファンクションを作ってください。そうすれば、あなたのコントラクトはリエントラントの悪用に対して攻撃されにくくなるでしょう。</p>
</div>
</div>
<div class="section" id="named-calls-and-anonymous-function-parameters">
<h3>Named Calls and Anonymous Function Parameters<a class="headerlink" href="#named-calls-and-anonymous-function-parameters" title="Permalink to this headline">¶</a></h3>
<p>ファンクションよ呼ぶ際の引数は <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">}</span></code> で囲えば下記の例のように任意の順番で、名前を与えることができます。引数の名前はファンクションの宣言の際のパラメータと一致する必要がありますが、順番は任意です。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">set</span><span class="p">({</span><span class="n">value</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">key</span><span class="o">:</span> <span class="mi">3</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">set</span><span class="p">(</span><span class="kt">uint</span> <span class="n">key</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="omitted-function-parameter-names">
<h3>Omitted Function Parameter Names<a class="headerlink" href="#omitted-function-parameter-names" title="Permalink to this headline">¶</a></h3>
<p>使われなかったパラメータの名前（特に返り値）は省略することができます。
そのパラメータはスタック上に残りますが、アクセスできません。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="c1">// omitted name for parameter</span>
    <span class="kd">function</span> <span class="n">func</span><span class="p">(</span><span class="kt">uint</span> <span class="n">k</span><span class="p">,</span> <span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">k</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-contracts-via-new">
<span id="creating-contracts"></span><span id="index-3"></span><h2>Creating Contracts via <code class="docutils literal notranslate"><span class="pre">new</span></code><a class="headerlink" href="#creating-contracts-via-new" title="Permalink to this headline">¶</a></h2>
<p>コントラクトは <code class="docutils literal notranslate"><span class="pre">new</span></code> というキーワードを使って他のコントラクトを作ることができます。コントラクトを作るコントラクトがコンパイルされる時に、作られるコントラクトのフルコードは既知である必要があります。そうすれば、再帰的なcreation-dependenciesは起きません。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">D</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">x</span><span class="p">;</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="n">a</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="n">D</span> <span class="n">d</span> <span class="o">=</span> <span class="k">new</span> <span class="n">D</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// will be executed as part of C&#39;s constructor</span>

    <span class="kd">function</span> <span class="n">createD</span><span class="p">(</span><span class="kt">uint</span> <span class="n">arg</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">D</span> <span class="n">newD</span> <span class="o">=</span> <span class="k">new</span> <span class="n">D</span><span class="p">(</span><span class="n">arg</span><span class="p">);</span>
        <span class="n">newD</span><span class="p">.</span><span class="n">x</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">createAndEndowD</span><span class="p">(</span><span class="kt">uint</span> <span class="n">arg</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="c1">// Send ether along with the creation</span>
        <span class="n">D</span> <span class="n">newD</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="n">D</span><span class="p">).</span><span class="n">value</span><span class="p">(</span><span class="n">amount</span><span class="p">)(</span><span class="n">arg</span><span class="p">);</span>
        <span class="n">newD</span><span class="p">.</span><span class="n">x</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上記の例の様に、<code class="docutils literal notranslate"><span class="pre">.value()</span></code> オプションを使って、<code class="docutils literal notranslate"><span class="pre">D</span></code> のインスタンスを作る時に、Etherを送ることができます。しかし、ガス量を制限することはできません。もし生成が失敗（スタックの制限、バランスの不足等で）したら、例外が投げられます。</p>
</div>
<div class="section" id="order-of-evaluation-of-expressions">
<h2>Order of Evaluation of Expressions<a class="headerlink" href="#order-of-evaluation-of-expressions" title="Permalink to this headline">¶</a></h2>
<p>式の評価の順番は決まっていません（正確には、式ツリーの中の1つのノードの子が評価される順番は決まっていませんが、そのノードが評価される前にはもちろん評価されています）。唯一保証されているのは、宣言は順番に実行され、boolean式に対する短絡評価もなされます。詳細は <a class="reference internal" href="miscellaneous.html#order"><span class="std std-ref">Order of Precedence of Operators</span></a> を参照ください。</p>
</div>
<div class="section" id="assignment">
<span id="index-4"></span><h2>Assignment<a class="headerlink" href="#assignment" title="Permalink to this headline">¶</a></h2>
<div class="section" id="destructuring-assignments-and-returning-multiple-values">
<span id="index-5"></span><h3>Destructuring Assignments and Returning Multiple Values<a class="headerlink" href="#destructuring-assignments-and-returning-multiple-values" title="Permalink to this headline">¶</a></h3>
<p>Solidityは内部ではタプル型を許可しています。例えば、コンパイル時に定数を持つ潜在的に異なるタイプのオブジェクトのリストです。
このタプルは同時に複数の値を返す時に使うことができます。これらは新しく宣言された変数や既に存在している変数（もしくは一般的に左辺値）に割り当てることができます。</p>
<p>タプルはSolidityでは適切な型ではありません。式のシンタックスのグルーピングを作るためだけに使用することができます。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">23</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="n">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">,</span> <span class="kt">bool</span><span class="p">,</span> <span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">g</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// Variables declared with type and assigned from the returned tuple,</span>
        <span class="c1">// not all elements have to be specified (but the number must match).</span>
        <span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">,</span> <span class="p">,</span> <span class="kt">uint</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">f</span><span class="p">();</span>
        <span class="c1">// Common trick to swap values -- does not work for non-value storage types.</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="c1">// Components can be left out (also for variable declarations).</span>
        <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">length</span><span class="p">,</span> <span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">f</span><span class="p">();</span> <span class="c1">// Sets the length to 7</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>変数の宣言と、宣言なしの値の割り当てを混ぜることはできません。例えば、次の式は無効です: <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">uint</span> <span class="pre">y)</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">2);</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">バージョン0.5.0以前では、片側が小さいサイズで、左辺か右辺（空の方）を補完する様なタプルを割り当てることができました。
現在これは禁止です。つまり両辺とも同じ数の要素を持っている必要があります。</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">参照型を含む複数の変数を同時に割り当てる際には気をつけてください。予期しないコピーを行う可能性があります。</p>
</div>
</div>
<div class="section" id="complications-for-arrays-and-structs">
<h3>Complications for Arrays and Structs<a class="headerlink" href="#complications-for-arrays-and-structs" title="Permalink to this headline">¶</a></h3>
<p>配列や構造体の様な非値型に対するアサインのセマンティクスは少し複雑です。
状態変数に対する割り当ては常に独立したコピーを生成します。一方で、ローカル変数への割り当ては基本型（例えば32バイトに収まる静的タイプ）の時のみ独立したコピーを生成します。もし構造体か配列（<code class="docutils literal notranslate"><span class="pre">bytes</span></code> や を含んでいる）が状態変数からローカル変数に割り当てられた場合、ローカル変数はオリジナルの状態変数への参照を持ちます。次にローカル変数へ割り当てても、ステートは変わらず、参照先のみ変更します。ローカル変数のメンバ（もしくは要素）への割り当てはステートを <em>変更します</em>。</p>
<p>下記の例で <code class="docutils literal notranslate"><span class="pre">g(x)</span></code> の呼び出しは <code class="docutils literal notranslate"><span class="pre">x</span></code> に何の影響も与えません。それはmemoryに独立したstorageの値を生成するからです。しかし、<code class="docutils literal notranslate"><span class="pre">h(x)</span></code> は <code class="docutils literal notranslate"><span class="pre">x</span></code> を変更します。それはコピーではなく参照が渡されているからです。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

 <span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="n">x</span><span class="p">;</span>

     <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="n">h</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>

     <span class="kd">function</span> <span class="n">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="kr">memory</span> <span class="n">y</span><span class="p">)</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="p">{</span>
        <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>

     <span class="kd">function</span> <span class="n">h</span><span class="p">(</span><span class="kt">uint</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="kr">storage</span> <span class="n">y</span><span class="p">)</span> <span class="kr">internal</span> <span class="p">{</span>
        <span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="scoping-and-declarations">
<span id="default-value"></span><span id="index-6"></span><h2>Scoping and Declarations<a class="headerlink" href="#scoping-and-declarations" title="Permalink to this headline">¶</a></h2>
<p>宣言された変数はバイト表現が全てゼロのデフォルト値を与えられます。変数の “デフォルト値” はどの型であれ一般的な “zero-state” です。例えば、<code class="docutils literal notranslate"><span class="pre">bool</span></code> のデフォルト値は <code class="docutils literal notranslate"><span class="pre">false</span></code> です。<code class="docutils literal notranslate"><span class="pre">uint</span></code> もしくは <code class="docutils literal notranslate"><span class="pre">int</span></code> 型のデフォルト値は <code class="docutils literal notranslate"><span class="pre">0</span></code> です。静的サイズの配列や <code class="docutils literal notranslate"><span class="pre">bytes1</span></code> から <code class="docutils literal notranslate"><span class="pre">bytes32</span></code> では、個々の要素がその型に応じたデフォルト値で初期化されます。最後に、動的サイズの配列や <code class="docutils literal notranslate"><span class="pre">bytes</span></code>、<code class="docutils literal notranslate"><span class="pre">string</span></code> に関してはデフォルト値は空の配列もしくは空の文字列です。</p>
<p>Solidityでのスコープは広く使われているC99のルールに従います: 変数は宣言直後からその宣言を含む最小の <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">}</span></code> ブロックの最後までvisibleです。このルールの例外として、forループ内の初期化内で宣言された変数はそのforループが終わるまでの間でだけvisibleです。</p>
<p>コードブロック外で変数や他の宣言されたもの、例えばファンクション、コントラクト、ユーザー定義型などは宣言される前からvisibleです。つまり、宣言前から状態変数を使うことができ、ファンクションを再帰的に呼び出すことができます。</p>
<p>その結果、2つの変数が同じ名前を持っていますが、バラバラのスコープを持つため、下記の例は警告なしでコンパイルされます。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">minimalScoping</span><span class="p">()</span> <span class="kr">pure</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="p">{</span>
            <span class="kt">uint</span> <span class="n">same</span><span class="p">;</span>
            <span class="n">same</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="p">{</span>
            <span class="kt">uint</span> <span class="n">same</span><span class="p">;</span>
            <span class="n">same</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>特別なC99のスコーピングルールの例として、下記の最初の <code class="docutils literal notranslate"><span class="pre">x</span></code> への割り当ては、実際はインナーの変数ではなく、アウターに割り当てられています。どの様な場合でもアウターの変数がシャドーイングされた時に警告が出ます。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="c1">// This will report a warning</span>
<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">pure</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">{</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// this will assign to the outer variable</span>
            <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// x has value 2</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<blockquote>
<div>バージョン0.5.0以前のSolidityではJavaScriptと同じスコーピングのルールに従っていました。そのルールとは、ファンクション内で宣言された変数のスコープは、どこで宣言されたか関係なく、そのファンクション全体というものです。下記の例は、以前はコンパイルされていましたが、バージョン0.5.0以降はエラーとなります。</div></blockquote>
<div class="last highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="c1">// This will not compile</span>
<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">pure</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="error-handling-assert-require-revert-and-exceptions">
<span id="assert-and-require"></span><span id="index-7"></span><h2>Error handling: Assert, Require, Revert and Exceptions<a class="headerlink" href="#error-handling-assert-require-revert-and-exceptions" title="Permalink to this headline">¶</a></h2>
<p>Solidityはエラーを処理するのにstate-revertingの例外を使っています。現在のコール（とそのサブコール全て）内で変更されたものを全て元に戻し、さらに呼び出し元に対してエラーのフラグをたてます。便利なファンクション <code class="docutils literal notranslate"><span class="pre">assert</span></code> と <code class="docutils literal notranslate"><span class="pre">require</span></code> はもし条件が満たされていない場合に例外を投げるために使用されます。
<code class="docutils literal notranslate"><span class="pre">assert</span></code> は内部エラーのテストと不変条件のチェックのためだけに使用するべきです。
<code class="docutils literal notranslate"><span class="pre">require</span></code> は有効な条件を保証するために使用するのが良いでしょう。例えば入力、コントラクトの状態変数が合致しているか、もしくは外部コントラクトから返ってきた値のバリデーションに使うことができます。
正しく使えば、分析ツールはコントラクトのコンディションとフェイル <code class="docutils literal notranslate"><span class="pre">assert</span></code> になるファンクションコールを見極めるためにコントラクトの評価を行うことができます。正しく実装されたコードはフェイルアサートが出ないはずです。もしそれでもアサートが出た場合、それは直さなくてはいけないバグです。</p>
<p>例外を引き起こす方法が2つあります: <code class="docutils literal notranslate"><span class="pre">revert</span></code> ファンクションはエラーにフラグを立て、現在のコールをrevertするのに使用することができます。呼び出し元に対して、詳細を含むエラーメッセージを返すことができます。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">以前は <code class="docutils literal notranslate"><span class="pre">throw</span></code> という <code class="docutils literal notranslate"><span class="pre">revert()</span></code> と同じセマンティクスのファンクションがありました。バージョン0.4.13で非推奨になり、バージョン0.5.0で削除されました。</p>
</div>
<p>サブコールで例外が発生した場合、その例外は自動的にどんどん出てきます（例外が再度投げられます）。このルールに対する例外は、<code class="docutils literal notranslate"><span class="pre">send</span></code> と低レベルファンクションの <code class="docutils literal notranslate"><span class="pre">call</span></code>、<code class="docutils literal notranslate"><span class="pre">delegatecall</span></code>、<code class="docutils literal notranslate"><span class="pre">staticcall</span></code> で、これらは例外がどんどん出てこない代わりに、<code class="docutils literal notranslate"><span class="pre">false</span></code> を返り値として最初に返します。</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">低レベルファンクションの <code class="docutils literal notranslate"><span class="pre">call</span></code>、<code class="docutils literal notranslate"><span class="pre">delegatecall</span></code>、<code class="docutils literal notranslate"><span class="pre">staticcall</span></code> は、もし呼ばれたアカウントが存在しない場合、EVMの設計上、最初の返り値として <code class="docutils literal notranslate"><span class="pre">true</span></code> を返します。もし必要なら、呼び出す前に存在確認をしなければいけません。</p>
</div>
<p>例外のキャッチはまだ可能ではありません。</p>
<p>下記の例では、<code class="docutils literal notranslate"><span class="pre">require</span></code> が入力に対するコンディションチェックを簡単に行なっているか見ることができます。また、<code class="docutils literal notranslate"><span class="pre">assert</span></code> がどの様に内部エラーのチェックに使用されうるのか確認できます。覚えて欲しいのは、<code class="docutils literal notranslate"><span class="pre">require</span></code> ではオプションでエラーメッセージを与えることができます。しかし <code class="docutils literal notranslate"><span class="pre">assert</span></code> ではできません。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Sharer</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">sendHalf</span><span class="p">(</span><span class="kt">address</span> <span class="kr">payable</span> <span class="n">addr</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nb">balance</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Even value required.&quot;</span><span class="p">);</span>
        <span class="kt">uint</span> <span class="n">balanceBeforeTransfer</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">;</span>
        <span class="n">addr</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="c1">// Since transfer throws an exception on failure and</span>
        <span class="c1">// cannot call back here, there should be no way for us to</span>
        <span class="c1">// still have half of the money.</span>
        <span class="nf">assert</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span> <span class="o">==</span> <span class="n">balanceBeforeTransfer</span> <span class="o">-</span> <span class="nb">msg.value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">return</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">assert</span></code>-スタイルの例外は下記のシチュエーションで発生します:</p>
<ol class="arabic simple">
<li>大きすぎるもしくは負のインデックスで配列にアクセスした場合(例： <code class="docutils literal notranslate"><span class="pre">x[i]</span></code> において <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">&gt;=</span> <span class="pre">x.length</span></code> もしくは <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">0</span></code>)。</li>
<li>大きすぎるもしくは負のインデックスで固定長 <code class="docutils literal notranslate"><span class="pre">bytesN</span></code> にアクセスした場合。</li>
<li>0で除算、剰余算を行なった場合(例: <code class="docutils literal notranslate"><span class="pre">5</span> <span class="pre">/</span> <span class="pre">0</span></code> もしくは <code class="docutils literal notranslate"><span class="pre">23</span> <span class="pre">%</span> <span class="pre">0</span></code>)。</li>
<li>負の数でシフトを行なった場合。</li>
<li>とても大きい、もしくは負の数を列挙型に変換した場合。</li>
<li>インターバルファンクション型のゼロ初期化された変数を呼び出した場合。</li>
<li>falseとなる引数で <code class="docutils literal notranslate"><span class="pre">assert</span></code> を呼び出した場合。</li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">require</span></code>-スタイルの例外は下記のシチュエーションで発生します:</p>
<ol class="arabic simple">
<li>falseとなる引数で <code class="docutils literal notranslate"><span class="pre">require</span></code> を呼び出した場合。</li>
<li>メッセージコールを通じてファンクションを呼び出したが、正常に終わらなかった場合（例えば、ガス不足、マッチするファンクションがなかった場合、それ自体が例外を投げた場合）、ただし低レベルのファンクション、<code class="docutils literal notranslate"><span class="pre">call</span></code>、<code class="docutils literal notranslate"><span class="pre">send</span></code>、<code class="docutils literal notranslate"><span class="pre">delegatecall</span></code>、<code class="docutils literal notranslate"><span class="pre">callcode</span></code> もしくは <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> が使用された場合を除きます。低レベルファンクションは例外を投げませんが、<code class="docutils literal notranslate"><span class="pre">false</span></code> を返すことで失敗を示します。</li>
<li><code class="docutils literal notranslate"><span class="pre">new</span></code> を使ってコントラクトを作ったものの、そのコントラクト作成が正常に終わらなかった場合（”正常に終わらない”の定義は上記参照）。</li>
<li>何もコードを含まないコントラクトを外から呼び出した場合。</li>
<li>コントラクトが <code class="docutils literal notranslate"><span class="pre">payable</span></code> modifierが付いていないpublicのファンクションを通じてEtherを受け取った場合（コンストラクタ、フォールバックファンクションを含む）。</li>
<li>コントラクトがpublicのgetterファンクションを通じてEtherを受け取った場合。</li>
<li><code class="docutils literal notranslate"><span class="pre">.transfer()</span></code> が失敗した場合。</li>
</ol>
<p>内部では、Solidityは <code class="docutils literal notranslate"><span class="pre">require</span></code>-スタイルの例外に対してrevert操作（<code class="docutils literal notranslate"><span class="pre">0xfd</span></code> 命令）を行います。また、<code class="docutils literal notranslate"><span class="pre">require</span></code>-スタイルの例外を投げるために、無効な操作を実行します。どちらのケースにおいても、ステートに対してなされた変更の全てをEVMがrevertする様にします。revertする理由は、期待した効果が実際には起きず、命令の実行を続ける安全な方法がないためです。トランザクションの原子性（一連のやりとりが全て実行されるか、1つも実行されない状態になること）を保ちたいので、最も安全な方法は全ての変更をrevertし、トランザクション全体（もしくは少なくとも呼び出し）の結果を無効にすることです。<code class="docutils literal notranslate"><span class="pre">assert</span></code>-スタイルの例外は全ての使用可能なガスをその呼び出しに使ってしまう一方で、<code class="docutils literal notranslate"><span class="pre">require</span></code>-スタイルの例外はガスを使いません。これはMetropolisがリリースされた時からスタートしました。</p>
<p>以下の例は、どの様にrevertとrequireでエラーメッセージが使われているかを示しています:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">VendingMachine</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">buy</span><span class="p">(</span><span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="nb">msg.value</span> <span class="o">/</span> <span class="mi">2</span> <span class="kc">ether</span><span class="p">)</span>
            <span class="nf">revert</span><span class="p">(</span><span class="s">&quot;Not enough Ether provided.&quot;</span><span class="p">);</span>
        <span class="c1">// Alternative way to do it:</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="n">amount</span> <span class="o">&lt;=</span> <span class="nb">msg.value</span> <span class="o">/</span> <span class="mi">2</span> <span class="kc">ether</span><span class="p">,</span>
            <span class="s">&quot;Not enough Ether provided.&quot;</span>
        <span class="p">);</span>
        <span class="c1">// Perform the purchase.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>与えられた文字列は、<a class="reference internal" href="abi-spec.html#abi"><span class="std std-ref">abi-encoded</span></a> となります。そしてそれはまるで <code class="docutils literal notranslate"><span class="pre">Error(string)</span></code> ファンクションを呼び出している様なものです。
上記の例では、<code class="docutils literal notranslate"><span class="pre">revert(&quot;Not</span> <span class="pre">enough</span> <span class="pre">Ether</span> <span class="pre">provided.&quot;);</span></code> は下記のエラーの返り値としてセットされた16進数データを生成します:</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="mh">0x08c379a0</span>                                                         <span class="c1">// Function selector for Error(string)</span>
<span class="mh">0x0000000000000000000000000000000000000000000000000000000000000020</span> <span class="c1">// Data offset</span>
<span class="mh">0x000000000000000000000000000000000000000000000000000000000000001a</span> <span class="c1">// String length</span>
<span class="mh">0x4e6f7420656e6f7567682045746865722070726f76696465642e000000000000</span> <span class="c1">// String data</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="contracts.html" class="btn btn-neutral float-right" title="Contracts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="units-and-global-variables.html" class="btn btn-neutral float-left" title="Units and Globally Available Variables" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2019, Ethereum

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>