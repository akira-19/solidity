

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Security Considerations &mdash; Solidity 0.5.4 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Resources" href="resources.html" />
    <link rel="prev" title="Solidity v0.5.0 Breaking Changes" href="050-breaking-changes.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Solidity
          

          
          </a>

          
            
            
              <div class="version">
                0.5.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction-to-smart-contracts.html">Introduction to Smart Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing-solidity.html">Installing the Solidity Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="solidity-by-example.html">Solidity by Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="solidity-in-depth.html">Solidity in Depth</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Security Considerations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pitfalls">Pitfalls</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#private-information-and-randomness">Private Information and Randomness</a></li>
<li class="toctree-l3"><a class="reference internal" href="#re-entrancy">Re-Entrancy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gas-limit-and-loops">Gas Limit and Loops</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sending-and-receiving-ether">Sending and Receiving Ether</a></li>
<li class="toctree-l3"><a class="reference internal" href="#callstack-depth">Callstack Depth</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tx-origin">tx.origin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#two-s-complement-underflows-overflows">Two’s Complement / Underflows / Overflows</a></li>
<li class="toctree-l3"><a class="reference internal" href="#minor-details">Minor Details</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#recommendations">Recommendations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#take-warnings-seriously">Take Warnings Seriously</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restrict-the-amount-of-ether">Restrict the Amount of Ether</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keep-it-small-and-modular">Keep it Small and Modular</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-the-checks-effects-interactions-pattern">Use the Checks-Effects-Interactions Pattern</a></li>
<li class="toctree-l3"><a class="reference internal" href="#include-a-fail-safe-mode">Include a Fail-Safe Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ask-for-peer-review">Ask for Peer Review</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#formal-verification">Formal Verification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-the-compiler.html">Using the compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Contract Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi-spec.html">Contract ABI Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="yul.html">Yul</a></li>
<li class="toctree-l1"><a class="reference internal" href="style-guide.html">Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-patterns.html">Common Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="bugs.html">List of Known Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="frequently-asked-questions.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="lll.html">LLL</a></li>
</ul>

            
          
    <a href="genindex.html">Keyword Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Solidity</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Security Considerations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/security-considerations.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="security-considerations">
<span id="id1"></span><h1>Security Considerations<a class="headerlink" href="#security-considerations" title="Permalink to this headline">¶</a></h1>
<p>想定通りに動くソフトウェアを作るのは割と簡単である一方で、<strong>想定していない</strong> 方法で誰かがそのソフトウェアを使うのをチェックするのは非常に難しいです。</p>
<p>Solidityでは、トークンやもしかしたらもっと価値のあるものを扱うためにスマートコントラクトを使うので、これは非常に重要です。さらに、スマートコントラクトの全ての実行は公に行われ、加えてソースコードは多くの場合誰でも見ることができます。</p>
<p>もちろん常にどの程度危険があるのか考えなくてはいけません。
スマートコントラクトと公にオープンなWebサービス（悪意のあるものも）やオープンソースを比較して下さい。
もし食料品の買い物リストをwebサービスに保存するなら、さほど気にする必要はないと思いますが、銀行口座を管理するなら、もっと気にする必要があります。</p>
<p>このセクションではいくつかの隠れた危険や、一般的なセキュリティに関する勧告をリストアップしますが、もちろん完璧にはできません。また、もしコントラクトコードにバグがなかったとしても、コンパイラやプラットフォーム自体にバグがあるかもしれません。パブリックに知られているコンパイラのセキュリティ関連のバグは <a class="reference internal" href="bugs.html#known-bugs"><span class="std std-ref">list of known bugs</span></a> で確認でき、これはコンピュータでも読み込めます。Solidityコンパイラのコード生成プログラムもカバーするバグの報奨制度もあります。</p>
<p>オープンソースドキュメントでは毎度の事ながら、このセクションをより良くするのにご助力下さい（特に、用例は助かります）。</p>
<div class="section" id="pitfalls">
<h2>Pitfalls<a class="headerlink" href="#pitfalls" title="Permalink to this headline">¶</a></h2>
<div class="section" id="private-information-and-randomness">
<h3>Private Information and Randomness<a class="headerlink" href="#private-information-and-randomness" title="Permalink to this headline">¶</a></h3>
<p>スマートコントラクトで使うもの全てはパブリックに見ることができます。たとえそれがローカル変数であったり、<code class="docutils literal notranslate"><span class="pre">private</span></code> とついた状態変数だったとしてもです。</p>
<p>スマートコントラクトでマイナーにズルをさせない様に乱数を使うのは結構難しいです。</p>
</div>
<div class="section" id="re-entrancy">
<h3>Re-Entrancy<a class="headerlink" href="#re-entrancy" title="Permalink to this headline">¶</a></h3>
<p>あるコントラクト(A)から別のコントラクト(B)に対する相互作用とEtherの送金はコントラクト(B)にコントロールを渡してしまいます。このおかげで、相互作用が完了する前にBがAに戻れてしまいます。下記の例ではバグが入っています（コントラクト全体ではなく一部です）。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span>
<span class="kd">contract</span> <span class="n">Fund</span> <span class="p">{</span>
    <span class="c1">/// Mapping of ether shares of the contract.</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">shares</span><span class="p">;</span>
    <span class="c1">/// Withdraw your share.</span>
    <span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">shares</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]))</span>
            <span class="n">shares</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">send</span></code> の一部としてガスが制限されているので大きな問題にはなりませんが、脆弱性を晒しています。Etherの送金は常にコードの実行を含んでいますので、受療者は <code class="docutils literal notranslate"><span class="pre">withdraw</span></code> をコールバックするコントラクトにもなり得ます。これは何度もリファンドすることを可能にし、基本的にはコントラクト中の全てのEtherを引き出せます。特に、下記のコントラクトでは、デフォルトで残っているガスを全て転送する <code class="docutils literal notranslate"><span class="pre">call</span></code> が使われているので、攻撃者が複数回リファンドができます。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span>
<span class="kd">contract</span> <span class="n">Fund</span> <span class="p">{</span>
    <span class="c1">/// Mapping of ether shares of the contract.</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">shares</span><span class="p">;</span>
    <span class="c1">/// Withdraw your share.</span>
    <span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,)</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">shares</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">])(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">success</span><span class="p">)</span>
            <span class="n">shares</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>re-entrancyを避けるために、下記で説明する様にChecks-Effects-Interactionsパターンを使うことができます。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Fund</span> <span class="p">{</span>
    <span class="c1">/// Mapping of ether shares of the contract.</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">shares</span><span class="p">;</span>
    <span class="c1">/// Withdraw your share.</span>
    <span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">share</span> <span class="o">=</span> <span class="n">shares</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
        <span class="n">shares</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">share</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>re-entrancyはEtherの送金だけでなく、他のコントラクト上でのファンクションコールでも起こり得ることを覚えておいて下さい。さらに、マルチコントラクトも考慮に入れる必要があります。呼び出されたコントラクトはあなたが使っている他のコントラクトのステートを変更する可能性があります。</p>
</div>
<div class="section" id="gas-limit-and-loops">
<h3>Gas Limit and Loops<a class="headerlink" href="#gas-limit-and-loops" title="Permalink to this headline">¶</a></h3>
<p>例えば、ストレージの値によって決まるループの様な繰り返しの回数が決まっていないループを使うときには気をつける必要があります。
ブロックガスリミットのため、トランザクションはある量のガスしか消費できません。明示化している、もしくは通常の演算のため、ループの繰り返し回数はブロックガスリミットを超えてしまい、あるところで不備がないコントラクトでも止まってしまいます。
これはブロックチェーンからデータを読み込むだけの <code class="docutils literal notranslate"><span class="pre">view</span></code> には適用されないかもしれませんが、オンチェーンの演算の一部として他のコントラクトから呼ばれた場合、その演算を止めるかもしれません。あなたのコントラクトのドキュメンテーションにこの様なケースについて明記して下さい。</p>
</div>
<div class="section" id="sending-and-receiving-ether">
<h3>Sending and Receiving Ether<a class="headerlink" href="#sending-and-receiving-ether" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>現状誰かがコントラクトもしくは”external accounts”にEtherを送るのを止めることはできません。
コントラクトは通常のtransferに対しては反応したり、拒否したりできますが、メッセージコールを生成しないでEtherを移動させる方法があります。その1つはシンプルにコントラクトアドレスに”マイニング”する方法で、2つ目は <code class="docutils literal notranslate"><span class="pre">selfdestruct(x)</span></code> を使うことです。</li>
<li>コントラクトがEtherを受け取ったとき（ファンクションを呼び出さないで）、フォールバックファンクションが実行されます。
もしフォールバックファンクションがなかった場合、Etherの送金は拒否されます（例外が投げられます）。
フォールバックファンクションの実行中、コントラクトはその時渡された利用可能な”gas stipend”にのみ頼っています（2300ガス）。このstipendはストレージを変更するには足りません（これが普通だとは考えないで下さい。このstipendは将来のハードフォークで変わる可能性があります）。
この方法でコントラクトが確実にEtherを受け取れる様にするために、フォールバックファンクションのガス要求を確認して下さい（具体的にはRemixの”details”セクションで）。</li>
<li><code class="docutils literal notranslate"><span class="pre">addr.call.value(x)(&quot;&quot;)</span></code> を使ってコントラクトにもっとガスを送る方法があります。
これは本質的には <code class="docutils literal notranslate"><span class="pre">addr.transfer(x)</span></code> と同じで、それは残っている全てのガスを送り、受領者がもっとガスがかかる演算を行わすことができます（自動でエラーを出す代わりにフェイラーコードを返します）。これは送信したコントラクトへのコールバックや多分想定していなかった他のステートの変更を含みます。そのため、健全なユーザに大きな柔軟性を与えますが、同時に悪意のあるユーザにも与えてしまいます。</li>
<li>もし <code class="docutils literal notranslate"><span class="pre">address.transfer</span></code> を使ってEtherを送りたい場合、気を付けないといけないことがあります。<ol class="arabic">
<li>もし受領者がコントラクトの場合、そのフォールバックファンクションが実行され、そのファンクションは次々にそのコントラクトにコールバックができます。</li>
<li>コール深さが1024以上になるとEtherの送信は失敗する可能性があります。呼び出し元はコール深さの完全なコントロールを握っていますので、transferを失敗させることができます。この可能性を考慮に入れるか、<code class="docutils literal notranslate"><span class="pre">send</span></code> を使ってその返り値を常にチェックして下さい。できたら、受領者がEtherを代わりに引き出せるパターンをコントラクトを書くときに使って下さい。</li>
<li>割り当てられたガス以上のガスを受領コントラクトの実行で要求した場合もEtherの送信は失敗します（明示的に <code class="docutils literal notranslate"><span class="pre">require</span></code>、<code class="docutils literal notranslate"><span class="pre">assert</span></code>、<code class="docutils literal notranslate"><span class="pre">revert</span></code>、<code class="docutils literal notranslate"><span class="pre">throw</span></code> を明示的に使った場合、もしくは処理コストが高すぎるため）- “ガス不足”(OOG)になります。返り値チェックと、<code class="docutils literal notranslate"><span class="pre">transfer</span></code> もしくは <code class="docutils literal notranslate"><span class="pre">send</span></code> を使う場合、コントラクトの送信中に処理を止める方法を受領者に与えてしまうかもしれません。もう一度、ここでのベストプラクティスは <a class="reference internal" href="common-patterns.html#withdrawal-pattern"><span class="std std-ref">“send” パターンの代わりに”withdraw” パターンを使うこと</span></a> です。</li>
</ol>
</li>
</ul>
</div>
<div class="section" id="callstack-depth">
<h3>Callstack Depth<a class="headerlink" href="#callstack-depth" title="Permalink to this headline">¶</a></h3>
<p>1024の最大コールスタックを超える場合、externalのファンクションコールはどんな時も失敗します。この様な状況では、Solidityは例外を投げます。
悪意のあるユーザはあなたのコントラクトと繋がる前にコールスタックに大きい値を入れれるかもしれません。</p>
<p>コールスタックが使い尽くされた場合、<code class="docutils literal notranslate"><span class="pre">.send()</span></code> は例外を <strong>投げません</strong> が、<code class="docutils literal notranslate"><span class="pre">false</span></code> を返すということを覚えておいて下さい。低レベルファンクションの``.call()``、<code class="docutils literal notranslate"><span class="pre">.callcode()</span></code>、<code class="docutils literal notranslate"><span class="pre">.delegatecall()</span></code>、<code class="docutils literal notranslate"><span class="pre">.staticcall()</span></code> も同じ様な挙動をします。</p>
</div>
<div class="section" id="tx-origin">
<h3>tx.origin<a class="headerlink" href="#tx-origin" title="Permalink to this headline">¶</a></h3>
<p>承認するのにtx.originは使わないでください。例えば、あなたが下記の様なウォレットコントラクトを持っていたとします。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span>
<span class="kd">contract</span> <span class="n">TxUserWallet</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="n">owner</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">transferTo</span><span class="p">(</span><span class="kt">address</span> <span class="kr">payable</span> <span class="n">dest</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">tx.origin</span> <span class="o">==</span> <span class="n">owner</span><span class="p">);</span>
        <span class="n">dest</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>今、誰かが下記の攻撃用ウォレットのアドレスにEtherを騙して送らさせます。</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">interface</span> <span class="n">TxUserWallet</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">transferTo</span><span class="p">(</span><span class="kt">address</span> <span class="kr">payable</span> <span class="n">dest</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="kr">external</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">TxAttackWallet</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="kr">payable</span> <span class="n">owner</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span><span class="p">()</span> <span class="kr">external</span> <span class="p">{</span>
        <span class="n">TxUserWallet</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">).</span><span class="n">transferTo</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="nb">msg.sender</span><span class="p">.</span><span class="nb">balance</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>もしあなたのウォレットが承認に <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> をチェックした場合、オーナーアドレスではなく、攻撃用ウォレットのアドレスを手に入れるでしょう。しかし、<code class="docutils literal notranslate"><span class="pre">tx.origin</span></code> をチェックした場合、トランザクションを始めたオリジナルのアドレスを取得しますので、それがオーナーアドレスになってしまいます。そして攻撃用ウォレットはすぐにファンドを全て取り出してしまいます。</p>
</div>
<div class="section" id="two-s-complement-underflows-overflows">
<span id="underflow-overflow"></span><h3>Two’s Complement / Underflows / Overflows<a class="headerlink" href="#two-s-complement-underflows-overflows" title="Permalink to this headline">¶</a></h3>
<p>多数のプログラミング言語の様にSolidityの整数型は実際には整数ではありません。値が小さい時は整数に見えますが、値が大きくなると異なる挙動を示します。
例えば、次の式は真です: <code class="docutils literal notranslate"><span class="pre">uint8(255)</span> <span class="pre">+</span> <span class="pre">uint8(1)</span> <span class="pre">==</span> <span class="pre">0</span></code>
これは <em>overflow</em> と言います。固定サイズの変数にその変数のデータ型の範囲外の数字（データ）を入れようとする演算が実行される時に起こります。<em>underflow</em> は逆の状況です: <code class="docutils literal notranslate"><span class="pre">uint8(0)</span> <span class="pre">-</span> <span class="pre">uint8(1)</span> <span class="pre">==</span> <span class="pre">255</span></code>。</p>
<p>一般に、2の補数表現の限度付近では符号付の数字のもっと特別なエッジケースがあります。</p>
<p>入力を合理的な範囲にサイズを制限するために <code class="docutils literal notranslate"><span class="pre">require</span></code> を使ってみて下さい。また、潜在的なオーバーフローを検知するために、<a class="reference internal" href="layout-of-source-files.html#smt-checker"><span class="std std-ref">SMT checker</span></a> を、または全てのオーバーフローに対してrevertさせたい時は <a class="reference external" href="https://github.com/OpenZeppelin/openzeppelin-solidity/blob/master/contracts/math/SafeMath.sol">SafeMath</a> を使って下さい。</p>
<p><code class="docutils literal notranslate"><span class="pre">require((balanceOf[_to]</span> <span class="pre">+</span> <span class="pre">_value)</span> <span class="pre">&gt;=</span> <span class="pre">balanceOf[_to])</span></code> の様なコードは値が期待通りかチェックするのにも役立ちます。</p>
</div>
<div class="section" id="minor-details">
<h3>Minor Details<a class="headerlink" href="#minor-details" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>32バイトをフルで占有しない型は”汚れた上位ビット”を含んでいるかもしれません。これは <code class="docutils literal notranslate"><span class="pre">msg.data</span></code> にアクセスする場合、特に重要で、展性リスクがあります: あるファンクション <code class="docutils literal notranslate"><span class="pre">f(uint8</span> <span class="pre">x)</span></code> を生のバイト引数 <code class="docutils literal notranslate"><span class="pre">0xff000001</span></code> と <code class="docutils literal notranslate"><span class="pre">0x00000001</span></code> で呼び出すトランザクションを作ることができます。両方ともコントラクトに渡され、<code class="docutils literal notranslate"><span class="pre">x</span></code> に関する限り、両方とも数字の <code class="docutils literal notranslate"><span class="pre">1</span></code> に見えますが、<code class="docutils literal notranslate"><span class="pre">msg.data</span></code> は違います。そのため、もし <code class="docutils literal notranslate"><span class="pre">keccak256(msg.data)</span></code> を使うと、異なる結果が得られます。</li>
</ul>
</div>
</div>
<div class="section" id="recommendations">
<h2>Recommendations<a class="headerlink" href="#recommendations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="take-warnings-seriously">
<h3>Take Warnings Seriously<a class="headerlink" href="#take-warnings-seriously" title="Permalink to this headline">¶</a></h3>
<p>もしコンパイラが何か警告を発したら、そこは変えたほうが良いです。
たとえ特別セキュリティに関係ないと思っても、その裏側では別の問題があるかもしれません。
コンパイラが発する警告は全て少しのコードの変更で消すことができます。</p>
<p>最近実装された全ての警告が出る様に、常に最新バージョンのコンパイラを使って下さい。</p>
</div>
<div class="section" id="restrict-the-amount-of-ether">
<h3>Restrict the Amount of Ether<a class="headerlink" href="#restrict-the-amount-of-ether" title="Permalink to this headline">¶</a></h3>
<p>スマートコントラクト内に保存されるEther（もしくは他のトークン）の量を制限してください。もしあなたのソースコード、コンパイラ、もしくはプラットフォームにバグがあったら、このファンドは全て失われるかもしれません。もし、ロスを制限したいのであれば、Etherの量を制限して下さい。</p>
</div>
<div class="section" id="keep-it-small-and-modular">
<h3>Keep it Small and Modular<a class="headerlink" href="#keep-it-small-and-modular" title="Permalink to this headline">¶</a></h3>
<p>コントラクトは小さくそして簡単に理解できる様にしておいて下さい。他のコントラクトもしくはライブラリの関係ない機能を見つけて下さい。もちろんソースコードのクオリティに関する一般的な勧告も使います: ローカル変数の量やファンクションの長さなどを制限して下さい。ファンクションに注記をつけて下さい。そうすれば他の人はあなたの意図が分かりますし、コードと意図が同じかどうかも分かります。</p>
</div>
<div class="section" id="use-the-checks-effects-interactions-pattern">
<h3>Use the Checks-Effects-Interactions Pattern<a class="headerlink" href="#use-the-checks-effects-interactions-pattern" title="Permalink to this headline">¶</a></h3>
<p>ほとんどのファンクションはまずいくつかのチェックで始まります（誰がファンクションを呼び出したのか、引数は範囲に入っているか、十分なEtherを送っているか、その人はトークンを持っているかなど）。これらのチェックは最初に終わらせなければいけません。</p>
<p>2つ目のステップとして、全てのチェックが通ったら、現在のコントラクトの状態変数の処理を行うはずです。
どんなファンクションでも他のファンクションとの相互作用は最後の最後に行われるはずです。</p>
<p>昔のコントラクトはいくつかの処理をデプロイしてからexternalのファンクションコールがノンエラーステートを返すのを待っていました。これは上記で説明したre-entrancy問題のため、しばしば大きな失敗となります。</p>
<p>さらに、既知のコントラクトをコールしても未知のコントラクトをどんどんコールする可能性があるということに気をつけて下さい。そのため、おそらく常にこのパターンを適用するのが良いでしょう。</p>
</div>
<div class="section" id="include-a-fail-safe-mode">
<h3>Include a Fail-Safe Mode<a class="headerlink" href="#include-a-fail-safe-mode" title="Permalink to this headline">¶</a></h3>
<p>システムを完全に非中央集権的にすると全ての仲介を除去することになる一方で、特に新しいコードにある種のフェイルセーフメカニズムを含めておくことは良いアイデアかもしれません。</p>
<p>“Etherのリークがあるか？”、”トークンの合計がコントラクトのバランスと一致するか”などの様なセルフチェックを実行するファンクションをスマートコントラクトに追加することができます。
大量のガスはこのために使えないことは頭に入れておいて下さい。おそらく、オフチェーンの計算が必要になるかもしれません。</p>
<p>セルフチェックが失敗したら、コントラクトは自動的にある種の”フェイルセーフ”モードに変わります。例えば、ほとんどの機能を無効にしたり、コントロールを決められたそして信頼できるサードパーティに渡したり、単にシンプルな”give me back my money”コントラクトに変換したりします。</p>
</div>
<div class="section" id="ask-for-peer-review">
<h3>Ask for Peer Review<a class="headerlink" href="#ask-for-peer-review" title="Permalink to this headline">¶</a></h3>
<p>たくさんの人がコードを調べれば、たくさんの問題が見つかります。
人に自分のコードのレビューを頼むことでそのコードが読みやすいかどうかクロスチェックすることになります。その読みやすさは良いスマートコントラクトの大切なクライテリアです。</p>
</div>
</div>
<div class="section" id="formal-verification">
<h2>Formal Verification<a class="headerlink" href="#formal-verification" title="Permalink to this headline">¶</a></h2>
<p>形式的検証を使って、あなたのコードがある形式の仕様を満たしているか証明する自動計算を行うことができます。
仕様は基準に則っています（ソースコードの様に）が、通常よりシンプルです</p>
<p>形式的検証自体はあなたがやった事（仕様）とどの様にやった（実際の実行）かの違いを理解するのに役立つだけです。そのため、仕様があなたのやりたかった事であるか、意図しない処理を見逃してないかどうかチェックする必要があります。</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="resources.html" class="btn btn-neutral float-right" title="Resources" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="050-breaking-changes.html" class="btn btn-neutral float-left" title="Solidity v0.5.0 Breaking Changes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2019, Ethereum

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>